

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Thm">
  <meta name="keywords" content="谭泓旻">
  
    <meta name="description" content="进程管理  描述与控制 进程的定义:  一个正在执行的程序 一个正在计算机上执行的程序实例 能分配给处理器并由处理器执行的实体 由一组执行的指令、一个当前状态和一组相关的系统资源表征的活动单元  进程的基本特征:  动态性(本质特性): 正在计算机上执行的程序实例，存在生命周期 并发性(重要特性): 任何进程都可以同其他进程一起向前推进 独立性: 各进程的地址空间相互独立，除非采用进程间通信手段">
<meta property="og:type" content="article">
<meta property="og:title" content="进程管理">
<meta property="og:url" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/index.html">
<meta property="og:site_name" content="Thm&#39;s blog">
<meta property="og:description" content="进程管理  描述与控制 进程的定义:  一个正在执行的程序 一个正在计算机上执行的程序实例 能分配给处理器并由处理器执行的实体 由一组执行的指令、一个当前状态和一组相关的系统资源表征的活动单元  进程的基本特征:  动态性(本质特性): 正在计算机上执行的程序实例，存在生命周期 并发性(重要特性): 任何进程都可以同其他进程一起向前推进 独立性: 各进程的地址空间相互独立，除非采用进程间通信手段">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/process_image.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/two_state_process_model.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/enter.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/exit.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/two_state_process_queuing.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/five_state_process_model.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/single_blocked_queue.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/multiple_blocked_queue.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/five_state_process_model_example.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/one_suspended_model.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/two_suspended_model.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/suspend.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/process_table.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/creat_process.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/process_switch_reason.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/unix_process_state_model.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/thread.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/multithreaded_process_model.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/multithreaded_process_example.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/ULT.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/KLT.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/scheduling.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/scheduling_state_transaction.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/RR_example.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/SJF_example.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/SRT_example.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/HRRN_example.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/FB_q=1.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/FB_q=2i.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/real_time_task.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/edf_example_question.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/edf_example_answer.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/RM.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/edf_idle_time_question.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/edf_idle_time_answer.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/preemption.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/concurrency_1.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/concurrency_1.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/signal.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/monitor.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/message_format.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/producers_consumers.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/reader_writer.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/barber.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/philosopher.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/deadlock_example_1.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/deadlock_example_2.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/circle_wait.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/deadlock_approach.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/safe_sequence.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/banker_algorithm.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/banker_algorithm_example_table.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/banker_algorithm_example_question.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/banker_algorithm_example_answer_1.png">
<meta property="og:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/banker_algorithm_example_answer_2.png">
<meta property="article:published_time" content="2023-02-10T05:05:39.000Z">
<meta property="article:modified_time" content="2023-02-12T14:23:28.802Z">
<meta property="article:author" content="Thm">
<meta property="article:tag" content="Operating System">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2023/02/10/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/process_image.png">
  
  
  <title>进程管理 - Thm&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>life and study balance</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="进程管理">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      Thm
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2023-02-10 13:05" pubdate>
        February 10, 2023 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      26k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      216 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">进程管理</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：February 12, 2023 pm
                
              </p>
            
            <div class="markdown-body">
              <h1 id="进程管理"><a class="markdownIt-Anchor" href="#进程管理"></a> 进程管理</h1>
<h2 id="描述与控制"><a class="markdownIt-Anchor" href="#描述与控制"></a> 描述与控制</h2>
<p>进程的<strong>定义</strong>:</p>
<ul>
<li>一个<strong>正在执行的程序</strong></li>
<li>一个<strong>正在</strong>计算机上执行的<strong>程序实例</strong></li>
<li>能<strong>分配给处理器并由处理器执行的实体</strong></li>
<li>由一组执行的<strong>指令</strong>、一个<strong>当前状态</strong>和一组相关的<strong>系统资源</strong>表征的活动单元</li>
</ul>
<p>进程的<strong>基本特征</strong>:</p>
<ul>
<li><strong>动态性(本质特性)</strong>: 正在计算机上执行的程序实例，<strong>存在生命周期</strong></li>
<li><strong>并发性(重要特性)</strong>: 任何进程都可以同其他进程<strong>一起</strong>向前推进</li>
<li><strong>独立性</strong>: 各进程的<strong>地址空间相互独立</strong>，除非采用进程间通信手段</li>
<li><strong>异步性</strong>: 按<strong>各自独立的、不可预知</strong>的速度向前推进</li>
</ul>
<p>进程与程序的<strong>区别</strong>:<br />
<b></p>
<ul>
<li>程序是静态的，而进程是动态的</li>
<li>进程包括了程序相关的数据</li>
<li>一个应用程序的执行可能有多个进程</li>
</ul>
</b>
<h3 id="进程结构"><a class="markdownIt-Anchor" href="#进程结构"></a> 进程结构</h3>
<p><strong>进程 = 程序代码 + 相关数据 + 进程控制块(PCB, Process Control Block)</strong><br />
<strong>进程映像(Process Image) = 程序代码段 + 数据 + PCB + 栈</strong><br />
<img src="process_image.png" srcset="/img/loading.gif" lazyload alt="进程映像在虚存中结构" /></p>
<h4 id="pcb"><a class="markdownIt-Anchor" href="#pcb"></a> PCB</h4>
<p>进程控制块<strong>包含了充分的信息</strong>， 因此可以中断一个进程的执行，并在后来恢复进程的执行，就好像进程未被中断过那样，PCB是OS<strong>支持多进程并提供多重处理技术</strong>的关键工具</p>
<p><strong>PCB的内容</strong>:<br />
<b></p>
<ul>
<li>进程标识信息</li>
<li>处理器状态信息</li>
<li>进程控制信息</li>
</ul>
</b>
<h5 id="进程标识信息"><a class="markdownIt-Anchor" href="#进程标识信息"></a> 进程标识信息</h5>
<p>操作系统控制的许多表可以使用<strong>进程标识符</strong>来引用进程表</p>
<ul>
<li>说明内存、I/O设备和文件分配给了<strong>哪个进程</strong></li>
<li>内存表、I/O和文件表都可以引用进程标识符，进而交叉引用<strong>进程表</strong></li>
<li>进程通信时，标识通信目标</li>
<li>指明每个进程的父进程和子进程</li>
</ul>
<p><strong>典型进程标识信息</strong>:</p>
<ul>
<li><strong>唯一的进程ID</strong></li>
<li><strong>父进程(创建该进程的进程)ID</strong></li>
<li><strong>用户ID</strong></li>
</ul>
<h5 id="处理器状态信息"><a class="markdownIt-Anchor" href="#处理器状态信息"></a> 处理器状态信息</h5>
<p>包括<strong>通用寄存器内容</strong>与<strong>标志寄存器内容</strong>，可以帮助处理器<strong>恢复现场</strong></p>
<p><strong>典型处理器状态信息</strong>:</p>
<ul>
<li><strong>用户可见寄存器</strong>内容: 部分通用寄存器(<strong>IA-32的EAX、EBX、ECX、EDX、ESI、EDI</strong>)</li>
<li><strong>栈寄存器</strong>内容: 每个进程有一个或多个与之相关联的后进先出(LIFO)系统栈，栈用于保存参数和过程调用或系统调用的地址(<strong>IA-32的ESP、EBP</strong>)</li>
<li><strong>标志寄存器</strong>内容: 程序计数器(<strong>EIP</strong>)和条件码寄存器(<strong>EFLAGS</strong>)</li>
</ul>
<h5 id="进程控制信息"><a class="markdownIt-Anchor" href="#进程控制信息"></a> 进程控制信息</h5>
<p>是操作系统<strong>控制和协调各种活动进程所需的额外信息</strong></p>
<p><strong>典型进程控制信息</strong>:</p>
<ul>
<li><strong>调度和状态</strong>信息:
<ul>
<li><strong>进程状态</strong>：如运行态、就绪态、等待态、停止态</li>
<li><strong>优先级</strong>：描述进程调度优先级的一个或多个域</li>
<li><strong>调度相关信息</strong>：具体取决于所用的调度算法，如进程等待的时间总量和进程上次运行的执行时间总量</li>
<li><strong>事件</strong>：进程在继续执行前等待的事件标识</li>
</ul>
</li>
<li><strong>数据结构</strong>信息: 进程可以以排队、环或其他数据结构链接到其他进程(如链表指向的下一个进程ID)</li>
<li><strong>进程间通信</strong>: 各种标记、信号和信息可与两个无关进程间的通信关联</li>
<li><strong>进程特权</strong>: 进程根据其可以访问的内存和可执行的指令类型来赋予特权</li>
<li><strong>存储管理</strong>: 包括指向描述分配给该进程的虚存的段表和/或页表的指针</li>
<li><strong>资源所有权和使用情况</strong>: 指示进程控制的资源(IO资源等)</li>
</ul>
<h3 id="进程状态"><a class="markdownIt-Anchor" href="#进程状态"></a> 进程状态</h3>
<h4 id="两状态模型"><a class="markdownIt-Anchor" href="#两状态模型"></a> 两状态模型</h4>
<p><img src="two_state_process_model.png" srcset="/img/loading.gif" lazyload alt="两状态模型" /></p>
<ul>
<li><strong>创建</strong>: 一个新进程添加到正被管理的进程集时，操作系统需要<strong>建立用于管理该进程的数据结构(PCB)</strong>，并<strong>在内存中给它分配地址空间</strong>，这些行为构成了一个新进程的创建过程<br />
<img src="enter.png" srcset="/img/loading.gif" lazyload alt="创建进程原因" /></li>
<li><strong>终止</strong>: 由<strong>批处理程序显式调用</strong>或<strong>用户指出进程</strong>何时结束，或<strong>进程进行非法操作时由OS进行终止</strong><br />
<img src="exit.png" srcset="/img/loading.gif" lazyload alt="终止进程原因" /></li>
</ul>
<p><img src="two_state_process_queuing.png" srcset="/img/loading.gif" lazyload alt="两状态模型排队" /><br />
当多进程需要处理时，未运行进程在<strong>创建队列进行排队</strong></p>
<h4 id="五状态模型"><a class="markdownIt-Anchor" href="#五状态模型"></a> 五状态模型</h4>
<p><img src="five_state_process_model.png" srcset="/img/loading.gif" lazyload alt="五状态模型" /></p>
<ul>
<li><strong>新建(New)</strong>: 刚刚创建的进程，操作系统还<strong>未把它加入可执行进程组</strong>，它通常是<strong>进程控制块己经创建但还未加载到内存中的新进程</strong></li>
<li><strong>就绪(Ready)</strong>: 进程做好了准备，<strong>只要有机会就开始执行</strong></li>
<li><strong>阻塞(Blocked)</strong>: 进程<strong>在某些事件发生前不能执行</strong>，如I/O操作完成</li>
<li><strong>运行(Runing)</strong>: 处理器<strong>正在执行该进程</strong></li>
<li><strong>退出(Eixt)</strong>: 操作系统<strong>从可执行进程组中释放出的进程</strong>，要么它自身<strong>已停止</strong>，要么它因某种原因<strong>被取消</strong></li>
</ul>
<p><img src="single_blocked_queue.png" srcset="/img/loading.gif" lazyload alt="单阻塞队列" /><br />
<strong>单阻塞队列: 所有阻塞进程位于一个阻塞队列</strong></p>
<p><img src="multiple_blocked_queue.png" srcset="/img/loading.gif" lazyload alt="多阻塞队列" /><br />
<strong>多阻塞队列: 不同事件对应一个阻塞队列</strong></p>
<p><img src="five_state_process_model_example.png" srcset="/img/loading.gif" lazyload alt="五状态模型转换示例" /></p>
<p><span style="color:#ff562b"><b>多队列思想同样可以用于就绪队列！从而对就绪进程进行优先级分级</b></span></p>
<h4 id="带挂起状态模型"><a class="markdownIt-Anchor" href="#带挂起状态模型"></a> 带挂起状态模型</h4>
<p><img src="one_suspended_model.png" srcset="/img/loading.gif" lazyload alt="单挂起态模型" /><br />
<img src="two_suspended_model.png" srcset="/img/loading.gif" lazyload alt="双挂起态模型" /></p>
<ul>
<li><strong>就绪/挂起(Ready/Suspended)</strong>: 进程<strong>己在外存</strong>中，但只要<strong>载入内存就可执行</strong></li>
<li><strong>阻塞/挂起(Blocked/Suspended)</strong>: 进程<strong>己在外存中并等待一个事件</strong></li>
</ul>
<p><img src="suspend.png" srcset="/img/loading.gif" lazyload alt="挂起进程原因" /></p>
<h3 id="进程控制"><a class="markdownIt-Anchor" href="#进程控制"></a> 进程控制</h3>
<p>操作系统采用表格(或数据结构)来<strong>记载各资源的信息</strong>，从而实现对资源的管理、维护、更新等，同时进程表必须能被操作系统所访问，因此其<strong>受制于内存管理</strong><br />
<img src="process_table.png" srcset="/img/loading.gif" lazyload alt="进程表" /></p>
<h4 id="操作系统内核"><a class="markdownIt-Anchor" href="#操作系统内核"></a> 操作系统内核</h4>
<p>OS内核是<strong>操作系统中包含重要系统功能的部分</strong>，并且需要<strong>常驻内存，便于提高操作系统运行效能</strong></p>
<p><strong>内核功能</strong>:</p>
<ul>
<li><strong>资源管理功能</strong>
<ul>
<li>进程管理: 进程的创建、终止、调度、分派、切换、通信等</li>
<li>存储管理: 内存管理和内外存交换</li>
<li>I/O设备管理: 缓冲区管理和I/O通道的分配</li>
</ul>
</li>
<li><strong>支撑功能</strong>
<ul>
<li>中断处理</li>
<li>时钟管理</li>
<li>记账功能</li>
</ul>
</li>
</ul>
<p><strong>处理器模式</strong>:</p>
<ul>
<li><strong>用户模式</strong>: 具有较少优先权的模式，运行用户程序</li>
<li><strong>内核模式</strong>: 运行操作系统的内核，执行某些特权指令，访问某些内存空间</li>
</ul>
<p>使用两种模式可以<strong>保护操作系统和重要的操作系统表(如PCB)不受程序干扰</strong></p>
<h4 id="进程创建"><a class="markdownIt-Anchor" href="#进程创建"></a> 进程创建</h4>
<p>当出现了需要创建进程的情况时，操作系统将按以下步骤创建一个新进程<br />
<img src="creat_process.png" srcset="/img/loading.gif" lazyload alt="进程创建" /></p>
<h4 id="进程切换"><a class="markdownIt-Anchor" href="#进程切换"></a> 进程切换</h4>
<p>进程切换指的是<strong>操作系统中断一个正在运行的进程，将另一个进程置于运行模式，并把控制权交给后者</strong></p>
<p><img src="process_switch_reason.png" srcset="/img/loading.gif" lazyload alt="进程切换原因" /></p>
<p><a target="_blank" rel="noopener" href="https://thm-lab.github.io/2022/06/09/%E4%B8%AD%E5%A4%AE%E5%A4%84%E7%90%86%E5%99%A8/#cpu%E5%AF%B9%E5%BC%82%E5%B8%B8%E7%9A%84%E5%A4%84%E7%90%86">异常和中断的区别</a>详见计组</p>
<p>但是！<strong>中断不一定会引起进程切换</strong>，例如I/O中断由CPU执行中断处理程序后仍然有可能切换为原进程<br />
然而<strong>进程切换一定会引起模式切换</strong>，因为<strong>进程切换需要切换到内核模式下完成进程调度</strong></p>
<p>进程切换的<strong>步骤</strong>:</p>
<ol>
<li><strong>保存处理器上下文环境</strong>，包括程序计数器和其它寄存器</li>
<li><strong>更新当前处于运行状态进程的进程控制块</strong></li>
<li>将进程的<strong>进程控制块移至相应队列</strong>(就绪、阻塞、就绪/挂起等)</li>
<li><strong>选择另一进程执行</strong></li>
<li><strong>更新其进程控制块信息</strong></li>
<li><strong>更新内存管理数据结构</strong></li>
<li><strong>恢复</strong>被选择进程的<strong>上下文环境</strong>，如载入程序计数器和其他寄存器先前的值</li>
</ol>
<h4 id="模式切换"><a class="markdownIt-Anchor" href="#模式切换"></a> 模式切换</h4>
<p>模式切换指<strong>用户模式和内核模式之间的相互转换</strong></p>
<p>由用户模式切到内核模式的原因:</p>
<ul>
<li><strong>系统调用</strong>: 是操作系统提供给用户程序<strong>访问系统内核功能的接口</strong>，用户程序通过调用系统调用来获取操作系统提供的服务，服务完成后返回应用程序</li>
<li><strong>中断</strong>: 以便中断处理能执行特权指令</li>
</ul>
<p>然而<strong>模式切换不一定会引起进程切换</strong>，某些系统调用(如getpid)就不会导致进程切换</p>
<h3 id="unix-svr4的进程管理"><a class="markdownIt-Anchor" href="#unix-svr4的进程管理"></a> Unix SVR4的进程管理</h3>
<p><img src="unix_process_state_model.png" srcset="/img/loading.gif" lazyload alt="Unix进程状态转换" /></p>
<p><strong>进程创建</strong>由<strong>内核系统调用fork()实现</strong><br />
fork()调用后的步骤:</p>
<ol>
<li>在<strong>进程表中</strong>为新进程<strong>分配一个空项</strong></li>
<li>为子进程<strong>分配一个唯一的进程标识符</strong></li>
<li><strong>复制</strong>父进程的<strong>进程映象</strong>，但共享内存除外</li>
<li><strong>增加父进程</strong>所拥有的<strong>文件的计数器</strong>，反映另一个进程现在也拥有这些文件的事实</li>
<li><strong>将子进程设置为就绪态</strong></li>
<li><strong>将子进程的ID号返回给父进程，将0值返回给子进程</strong></li>
</ol>
<p><strong>fork()创建子进程之后，父进程和子进程均在下一条语句上继续运行</strong><br />
<strong>fork()创建子进程之后，执行返回父进程，或调度切换到子进程或其他进程(与OS的调度算法有关)</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br>#Include&lt;sys/types.h&gt;<br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hello\n&quot;</span>);<br>  fork(); <br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Bye\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>输出:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">Hello<br>Bye<br>Bye<br></code></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-type">int</span> i;<br>  <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">3</span>;i++)<br>    fork();<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hello, world\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>输出: 共<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mn>3</mn></msup><mo>=</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">2^3=8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span>个<code>hello, world</code>(8个进程，每个进程打印一个)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">hello, world<br>hello, world<br>hello, world<br>hello, world<br>hello, world<br>hello, world<br>hello, world<br>hello, world<br></code></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-type">int</span> global = <span class="hljs-number">4</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>  <span class="hljs-type">int</span>  pid;<br>  <span class="hljs-type">int</span> vari = <span class="hljs-number">5</span>;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;before fork\n&quot;</span>);<br><br>  <span class="hljs-keyword">if</span> ((pid = fork()) &lt; <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;fork error\n&quot;</span>);<br>      <br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) &#123;<br>  global++;<br>  vari--;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;child\n&quot;</span>);<br>  &#125;<br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;global=%d,vari=%d\n&quot;</span>, global, vari);<br> <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>输出: 因为子进程是<strong>复制</strong>了父进程的<strong>进程映像</strong>(除共享空间外)，因此<strong>不会影响父进程的数据</strong>，<strong>子进程数据为自己独有</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">before fork<br>global=4,vari=5<br>child<br>global=5,vari=4<br></code></pre></td></tr></table></figure>
<h3 id="线程"><a class="markdownIt-Anchor" href="#线程"></a> 线程</h3>
<p>进程的<strong>2个基本属性</strong>:</p>
<ul>
<li><strong>进程是拥有资源的独立单位</strong></li>
<li><strong>进程是调度/执行的基本单位</strong>，挂起进程会导致内部所有线程被挂起，终止进程会导致内部所有线程被终止，因此线程只是独立调度和分配的基本单位</li>
</ul>
<p><strong>线程</strong>是进程中的一个实体，<strong>是独立调度和分配的基本单位</strong><br />
<img src="thread.png" srcset="/img/loading.gif" lazyload alt="线程" /></p>
<ul>
<li>单进程单线程: MS Dos等</li>
<li>单进程多线程: JVM(Java虚拟机)等</li>
<li>多进程单线程: 传统Unix等</li>
<li>多进程多线程: 现在操作系统(Windows、Solaris)等</li>
</ul>
<p><img src="multithreaded_process_model.png" srcset="/img/loading.gif" lazyload alt="多线程模型" /><br />
进程内可能有多个线程，每个线程都有<strong>包含线程信息的TCB</strong>(Thread Control Block)、线程<strong>代码</strong>、<strong>局部变量的静态存储空间</strong>、<strong>执行栈</strong>和<strong>与进程内其他线程共享的内存和资源访问</strong></p>
<p>线程的<strong>优点</strong>:</p>
<ul>
<li><strong>创建时间短</strong></li>
<li><strong>终止时间短</strong></li>
<li><strong>切换时间短</strong></li>
<li>执行程序间的通信效率高(<strong>进程通信难度大于线程通信</strong>)</li>
</ul>
<p><img src="multithreaded_process_example.png" srcset="/img/loading.gif" lazyload alt="多线程示例" /></p>
<h4 id="线程分类"><a class="markdownIt-Anchor" href="#线程分类"></a> 线程分类</h4>
<p>可以分为:</p>
<ul>
<li><strong>用户级线程(ULT)</strong></li>
<li><strong>内核级线程(KLT)</strong></li>
<li>混合方法</li>
</ul>
<h5 id="ult"><a class="markdownIt-Anchor" href="#ult"></a> ULT</h5>
<p><img src="ULT.png" srcset="/img/loading.gif" lazyload alt="用户级线程" /><br />
<strong>线程由用户自己管理(创建、终止、调度、挂起)</strong>，OS不知道有线程存在</p>
<h5 id="klt"><a class="markdownIt-Anchor" href="#klt"></a> KLT</h5>
<p><img src="KLT.png" srcset="/img/loading.gif" lazyload alt="内核级线程" /><br />
线程管理由OS进行，应用程序无法参与线程管理</p>
<h5 id="不同类型线程优缺点"><a class="markdownIt-Anchor" href="#不同类型线程优缺点"></a> 不同类型线程优缺点</h5>
<table>
<thead>
<tr>
<th>线程类型</th>
<th>用户级</th>
<th>内核级</th>
<th>混合方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>优点</td>
<td><strong>线程切换不需要内核模式特权</strong><br><strong>调度策略因应用程序不同而不同</strong><br><strong>可以运行在任何操作系统上</strong></td>
<td>内核可以把同一个进程内的<strong>多个线程调度到多处理器上</strong>，<strong>提高并发性</strong><br><strong>当一个线程阻塞时，内核可以调度同一进程内的其他线程</strong><br><strong>内核例程本身也可以是多线程的，提高了内核的运行效率</strong></td>
<td><strong>线程创建在用户空间完成</strong>(开销小，不需要模式切换)<br><strong>线程调度和同步也由应用程序完成</strong>(开销小，不需要模式切换)<br><strong>一个应用程序中的多个线程被映射到一些</strong>(小于或等于用户级线程数)</td>
</tr>
<tr>
<td>缺点</td>
<td>当用户级线程执行系统调用时，不仅阻塞当前线程，还<strong>将引起同一进程中的其他线程阻塞</strong><br><strong>不能利用多处理器技术</strong></td>
<td>把控制权从一个线程传递到相同进程内的另一个线程时，需要<strong>切换到内核模式</strong>(<strong>由OS进行线程切换</strong>)</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="调度"><a class="markdownIt-Anchor" href="#调度"></a> 调度</h2>
<h3 id="调度类型"><a class="markdownIt-Anchor" href="#调度类型"></a> 调度类型</h3>
<p>调度的<strong>目的</strong>是以<strong>满足系统目标</strong>(如响应时间、吞吐率、处理器效率)的方式，把进程分配到一个或多个处理器上执行<br />
在本节中仅考虑<strong>单处理器</strong>，多处理器的调度复杂度远高于单处理器调度</p>
<p>首先可以将调度进行分类:</p>
<ul>
<li><strong>长程调度</strong>: 长程调度程序决定哪个程序可以进入系统中处理(创建进程)，因此它控制了系统的并发度，常见的调度算法: <strong>先来先服务FCFS</strong>或<strong>根据优先级、期望执行时间等进行调度</strong></li>
<li><strong>中程调度</strong>: 中程调度是交换功能的一部分(主要是<strong>进程在内存与外存的管理</strong>)，<strong>调度算法与存储管理相关</strong></li>
<li><strong>短程调度</strong>: <strong>由就绪状态中挑选进程进入执行状态</strong>，调度算法将在下面详细介绍</li>
</ul>
<p><img src="scheduling.png" srcset="/img/loading.gif" lazyload alt="调度层次" /><br />
<img src="scheduling_state_transaction.png" srcset="/img/loading.gif" lazyload alt="状态转变的调度层级" /></p>
<p><strong>本节也主要关注短程调度</strong></p>
<h3 id="调度标准"><a class="markdownIt-Anchor" href="#调度标准"></a> 调度标准</h3>
<ul>
<li><strong>响应时间</strong>: <strong>从用户提交一个请求开始，到接收到第一个响应之间的时间间隔</strong>，响应时间 = 输入传送时间 + 计算时间 + 响应传送时间</li>
<li><strong>周转时间</strong>: <strong>从作业提交开始，到作业完成之间的时间间隔</strong></li>
<li><strong>截止时间</strong>: 某任务<strong>必须开始执行的最迟时间</strong>，或<strong>必须完成的最迟时间</strong></li>
<li><strong>吞吐量</strong>: <strong>单位时间内完成的进程数量</strong></li>
<li><strong>处理器利用率</strong>: <strong>处理器处于忙状态的时间百分比</strong></li>
</ul>
<p><span style="color:#ff562b"><b>响应时间与周转时间无法比较长短，如果进程只进行一次响应后即结束，则响应时间等于周转时间；如果进程需要响应多次，则响应时间小于周转时间</b></span></p>
<ul>
<li><strong>平均周转时间</strong>: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>T</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">T = \frac{1}{n} \sum_{i=1}^{n} T_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li><strong>带权周转时间</strong>: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>W</mi><mo>=</mo><mfrac><mi>T</mi><msub><mi>T</mi><mi>s</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">W = \frac{T}{T_{s}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.317431em;vertical-align:-0.44509999999999994em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.13889em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，其中T为<strong>周转时间</strong>，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">T_s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为<strong>系统为进程服务时间</strong></li>
<li><strong>平均带权周转时间</strong>: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mo>=</mo><mfrac><mn>1</mn><mi>n</mi></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>W</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">T = \frac{1}{n} \sum_{i=1}^{n} W_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
</ul>
<h3 id="调度决策"><a class="markdownIt-Anchor" href="#调度决策"></a> 调度决策</h3>
<h4 id="调度规则"><a class="markdownIt-Anchor" href="#调度规则"></a> 调度规则</h4>
<p><strong>短程调度</strong>的主要目标: <strong>按照优化系统某些方面的方式，来分配处理器时间</strong></p>
<p>调度规则的影响因素: <strong>面向用户/面向系统</strong>与<strong>性能相关/性能无关</strong></p>
<ul>
<li><strong>面向用户且性能相关</strong>: <strong>周转时间、响应时间、截止时间</strong></li>
<li><strong>面向用户且性能无关</strong>: <strong>可预测性</strong></li>
<li><strong>面向系统且性能相关</strong>: <strong>吞吐量、处理器利用率</strong></li>
<li><strong>面向系统且性能无关</strong>: <strong>公平性、强制优先级、平衡资源</strong></li>
</ul>
<p><strong>优先级: 通过多条就绪队列进行实现</strong></p>
<h4 id="调度模式"><a class="markdownIt-Anchor" href="#调度模式"></a> 调度模式</h4>
<ul>
<li>非抢占式: 执行进程只有在<strong>执行完毕</strong>，或因申请I/O或请求某些操作系统服务而<strong>阻塞自己</strong>时，才释放处理器</li>
<li>抢占式: 执行进程可能被操作系统中断，并转换为<strong>就绪态</strong>，抢占发生原因:
<ul>
<li><strong>新进程到达</strong></li>
<li><strong>中断发生后把一个阻塞进程置为就绪态</strong></li>
<li><strong>周期性的时钟中断(防止独占)</strong></li>
</ul>
</li>
</ul>
<h4 id="调度函数"><a class="markdownIt-Anchor" href="#调度函数"></a> 调度函数</h4>
<p>关键参数:<br />
<b></p>
<ul>
<li>w: 目前为止在系统里的等待时间</li>
<li>e: 目前为止花费的执行时间</li>
<li>s: 进程所需的总服务时间(用户提供或估计)</li>
</ul>
</b>
<h3 id="调度算法"><a class="markdownIt-Anchor" href="#调度算法"></a> 调度算法</h3>
<b>
<ul>
<li>先来先服务(First Come First Served, FCFS)</li>
<li>时间片轮转(Round Robin, RR)</li>
<li>短作业优先(Shortest Job First, SJF)</li>
<li>剩余时间最短优先(Shortest Remaining Time, SRT)</li>
<li>响应比高优先(Highest Response Ratio Next, HRRN)</li>
<li>反馈(Feedback, FB)</li>
</ul>
</b>
<h4 id="fcfs"><a class="markdownIt-Anchor" href="#fcfs"></a> FCFS</h4>
<p>说明: 按照<strong>到达的先后顺序来调度，属于非抢占调度方式</strong></p>
<p>评价:</p>
<ul>
<li><strong>有利于CPU繁忙型</strong>的进程，而<strong>不利于I/O繁忙型</strong>的进程(<strong>CPU繁忙型会持续占有CPU</strong>，而<strong>I/O繁忙型进程进行I/O后需要重新排队</strong>)</li>
<li><strong>平均周转时间长</strong>，<strong>不适合直接用于单处理器系统,通常与其它调度算法混合使用</strong></li>
</ul>
<h4 id="rr"><a class="markdownIt-Anchor" href="#rr"></a> RR</h4>
<p>说明: 每个进程被<strong>分配一个时间片</strong>，周期性产生时钟中断，<strong>中断时当前进程进入就绪队列末尾</strong>，<strong>基于FCFS选择下一个作业运行</strong>，如果进程在时间片内<strong>阻塞或结束</strong>，则<strong>立即切换</strong>进程</p>
<p>评价:</p>
<ul>
<li>属于<strong>抢占调度方式</strong></li>
<li><strong>时间片的设置</strong>与系统性能、响应时间密切相关
<ul>
<li>当时间片趋于无穷大时: RR变为FCFS，对CPU繁忙型有利，同样会<strong>引起对短的交互请求的响应时间变长</strong></li>
<li>当时间片为1时，对I/O繁忙型较为有利(<strong>但IO阻塞后仍需排队</strong>)，但<strong>频繁切换进程降低了CPU的效率</strong></li>
<li>因此时间片最好<strong>略大于一次典型交互的时间</strong>，仍对CPU繁忙型有利</li>
</ul>
</li>
</ul>
<p>RR算法在<strong>通用的分时系统</strong>或<strong>事务处理系统</strong>中特别有效</p>
<p><img src="RR_example.png" srcset="/img/loading.gif" lazyload alt="示例" /><br />
<strong>平均周转时间</strong> = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mn>4</mn><mo>+</mo><mn>16</mn><mo>+</mo><mn>13</mn><mo>+</mo><mn>14</mn><mo>+</mo><mn>7</mn></mrow><mn>5</mn></mfrac><mo>=</mo><mn>10.8</mn></mrow><annotation encoding="application/x-tex">\frac{4+16+13+14+7}{5}=10.8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mord mtight">6</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mord mtight">3</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mord mtight">4</span><span class="mbin mtight">+</span><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">.</span><span class="mord">8</span></span></span></span>，<strong>平均带权周转时间</strong> = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mfrac><mn>4</mn><mn>3</mn></mfrac><mo>+</mo><mfrac><mn>16</mn><mn>6</mn></mfrac><mo>+</mo><mfrac><mn>13</mn><mn>4</mn></mfrac><mo>+</mo><mfrac><mn>14</mn><mn>5</mn></mfrac><mo>+</mo><mfrac><mn>7</mn><mn>2</mn></mfrac></mrow><mn>5</mn></mfrac><mo>=</mo><mn>2.71</mn></mrow><annotation encoding="application/x-tex">\frac{\frac{4}{3}+\frac{16}{6}+\frac{13}{4}+\frac{14}{5}+\frac{7}{2}}{5}=2.71</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.48682em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.14182em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5508em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">.</span><span class="mord">7</span><span class="mord">1</span></span></span></span></p>
<p><strong>VRR</strong>: 是对RR的改进，<strong>增加一个辅助队列，接收I/O阻塞完成的进程，调度优先于就绪队列，但占用的处理机时间小于就绪队列的时间片</strong></p>
<h4 id="sjf"><a class="markdownIt-Anchor" href="#sjf"></a> SJF</h4>
<p>说明: <strong>根据用户提供的或估算的作业执行时间进行调度，选择执行时间最短的作业交给CPU</strong></p>
<p>评价:</p>
<ul>
<li><strong>属于非抢占调度方式</strong>，短进程跳到队列头，<strong>可能导致长进程饥饿</strong>，因此不适用于分时系统或事务处理环境</li>
<li>有利于短进程，<strong>减小了平均周转时间</strong>(非抢占调度下，长进程一般会导致短进程的高周转时间，所以有利于短进程能减小平均周转时间)</li>
<li>进程的长短根据用户所提供的估计执行时间而定，用户估计不准时，导致该算法不一定能真正做到短作业优先调度</li>
</ul>
<p><img src="SJF_example.png" srcset="/img/loading.gif" lazyload alt="示例" /><br />
<strong>平均周转时间</strong> = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mn>3</mn><mo>+</mo><mn>7</mn><mo>+</mo><mn>11</mn><mo>+</mo><mn>14</mn><mo>+</mo><mn>3</mn></mrow><mn>5</mn></mfrac><mo>=</mo><mn>7.6</mn></mrow><annotation encoding="application/x-tex">\frac{3+7+11+14+3}{5}=7.6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mbin mtight">+</span><span class="mord mtight">7</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mord mtight">4</span><span class="mbin mtight">+</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">7</span><span class="mord">.</span><span class="mord">6</span></span></span></span>，<strong>平均带权周转时间</strong> = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mfrac><mn>3</mn><mn>3</mn></mfrac><mo>+</mo><mfrac><mn>7</mn><mn>6</mn></mfrac><mo>+</mo><mfrac><mn>11</mn><mn>4</mn></mfrac><mo>+</mo><mfrac><mn>14</mn><mn>5</mn></mfrac><mo>+</mo><mfrac><mn>3</mn><mn>2</mn></mfrac></mrow><mn>5</mn></mfrac><mo>=</mo><mn>1.78</mn></mrow><annotation encoding="application/x-tex">\frac{\frac{3}{3}+\frac{7}{6}+\frac{11}{4}+\frac{14}{5}+\frac{3}{2}}{5}=1.78</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.48682em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.14182em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5508em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">7</span><span class="mord">8</span></span></span></span></p>
<h4 id="srt"><a class="markdownIt-Anchor" href="#srt"></a> SRT</h4>
<p>说明: <strong>调度程序总是选择预期剩余时间最短的进程</strong>，当一个新进程加入就绪队列时，如果它比当前运行的进程具有更短的剩余时间，就可能<strong>抢占</strong>当前正在运行的进程</p>
<p>评价:</p>
<ul>
<li><strong>属于抢占式调度方式</strong>，既不像FCFS那样偏爱长进程(非抢占式)，也不像RR算法那样会产生很多额外的中断(因时间片而产生)，从而<strong>减少了开销</strong></li>
<li>周转时间短，SRT比SJF性能要好，只要就绪，短作业可以立即被选择执行</li>
<li><strong>需要估计预期的服务时间</strong>(估计可能不准)</li>
<li><strong>存在长进程饥饿现象</strong></li>
<li><strong>必须记录进程的已服务时间</strong></li>
</ul>
<p><img src="SRT_example.png" srcset="/img/loading.gif" lazyload alt="示例" /><br />
<strong>平均周转时间</strong> = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mn>3</mn><mo>+</mo><mn>13</mn><mo>+</mo><mn>4</mn><mo>+</mo><mn>14</mn><mo>+</mo><mn>2</mn></mrow><mn>5</mn></mfrac><mo>=</mo><mn>7.2</mn></mrow><annotation encoding="application/x-tex">\frac{3+13+4+14+2}{5}=7.2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mord mtight">3</span><span class="mbin mtight">+</span><span class="mord mtight">4</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mord mtight">4</span><span class="mbin mtight">+</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">7</span><span class="mord">.</span><span class="mord">2</span></span></span></span>，<strong>平均带权周转时间</strong> = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mfrac><mn>3</mn><mn>3</mn></mfrac><mo>+</mo><mfrac><mn>13</mn><mn>6</mn></mfrac><mo>+</mo><mfrac><mn>4</mn><mn>4</mn></mfrac><mo>+</mo><mfrac><mn>14</mn><mn>5</mn></mfrac><mo>+</mo><mfrac><mn>2</mn><mn>2</mn></mfrac></mrow><mn>5</mn></mfrac><mo>=</mo><mn>1.59</mn></mrow><annotation encoding="application/x-tex">\frac{\frac{3}{3}+\frac{13}{6}+\frac{4}{4}+\frac{14}{5}+\frac{2}{2}}{5}=1.59</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.48682em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.14182em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5508em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mord">9</span></span></span></span></p>
<h4 id="hrrn"><a class="markdownIt-Anchor" href="#hrrn"></a> HRRN</h4>
<p>说明: <strong>选择就绪队列中响应比最高的进程投入执行</strong><br />
<strong>响应比</strong>: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><msub><mi>T</mi><mi>w</mi></msub><mo>+</mo><msub><mi>T</mi><mi>s</mi></msub></mrow><msub><mi>T</mi><mi>s</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">\frac{T_w + T_s}{T_s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3335309999999998em;vertical-align:-0.44509999999999994em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8884309999999999em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.13889em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.13889em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.13889em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mi>w</mi></msub></mrow><annotation encoding="application/x-tex">T_w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为进程等待时间<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">，</mi><msub><mi>T</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">，T_s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord cjk_fallback">，</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为估计的作业执行时间</p>
<p>评价:</p>
<ul>
<li><strong>属于非抢占式</strong>调度方法，实质上是一种动态优先权调度算法</li>
<li>是FCFS和SJF的结合，<strong>既照顾了短进程，又考虑了作业到达的先后次序</strong>，不会使长进程长期得不到服务</li>
<li>需要计算响应比，<strong>增加系统开销</strong>，且难以准确计算(<strong>需要估计执行时间</strong>)</li>
</ul>
<p><img src="HRRN_example.png" srcset="/img/loading.gif" lazyload alt="示例" /><br />
<strong>平均周转时间</strong> = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mn>3</mn><mo>+</mo><mn>7</mn><mo>+</mo><mn>9</mn><mo>+</mo><mn>14</mn><mo>+</mo><mn>7</mn></mrow><mn>5</mn></mfrac><mo>=</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">\frac{3+7+9+14+7}{5}=8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mbin mtight">+</span><span class="mord mtight">7</span><span class="mbin mtight">+</span><span class="mord mtight">9</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mord mtight">4</span><span class="mbin mtight">+</span><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span>，<strong>平均带权周转时间</strong> = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mfrac><mn>3</mn><mn>3</mn></mfrac><mo>+</mo><mfrac><mn>7</mn><mn>6</mn></mfrac><mo>+</mo><mfrac><mn>9</mn><mn>4</mn></mfrac><mo>+</mo><mfrac><mn>14</mn><mn>5</mn></mfrac><mo>+</mo><mfrac><mn>7</mn><mn>2</mn></mfrac></mrow><mn>5</mn></mfrac><mo>=</mo><mn>2.14</mn></mrow><annotation encoding="application/x-tex">\frac{\frac{3}{3}+\frac{7}{6}+\frac{9}{4}+\frac{14}{5}+\frac{7}{2}}{5}=2.14</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.48682em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.14182em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5508em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">9</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">.</span><span class="mord">1</span><span class="mord">4</span></span></span></span></p>
<h4 id="fb"><a class="markdownIt-Anchor" href="#fb"></a> FB</h4>
<p>SJF、SRT和HARRN都采用了<strong>进程估计执行时间</strong>这一参数作为调度的因素来<strong>奖励短进程从而降低平均周转时间</strong>，然而该参数很难进行准确估算<br />
而FB采用的是惩罚长进程的思想，其关注进程的<strong>已执行时间</strong>参数，该参数可以被精准测量，根据进程执行历史，<strong>调度基于按时间片的抢占原则</strong></p>
<p>说明:</p>
<ol>
<li>设置多个就绪队列，每个队列赋予不同优先级(<strong>第一队列优先级最高，依次递减，各个队列中进程执行的时间片不相同，优先级越高的队列，时间片越小</strong>)</li>
<li>新进程进入时，首先放入第一个队列尾(<strong>优先级默认最高</strong>)，按FCFS原则排队</li>
<li>如果进程在当前队列规定的时间片内<strong>完成则退出</strong>，<strong>未完成则抢占</strong>，一般而言，从队列i中调度的进程允许执行<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding="application/x-tex">2^i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.824664em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span></span></span></span>的时间，然后才被抢占，降级到下一个优先级队列(<strong>如果没有其他进程需调度，则当前进程不降级</strong>)</li>
<li><strong>到达最低优先级队列后，不再降级</strong></li>
<li><strong>仅当第一队列空闲时，才调度第二队列中的进程，依次类推</strong></li>
</ol>
<p>评价:</p>
<ul>
<li><strong>属于抢占式调度方式</strong>，能<strong>较好地满足各种类型用户</strong>的需要</li>
<li><strong>有利于终端型作业用户</strong>: 常为短作业，<strong>能在第一队列所规定的时间片内完</strong></li>
<li><strong>对短作业用户有利</strong>: <strong>能在前几个队列所规定的时间片内完成</strong></li>
<li><strong>长进程</strong>: 将依次在第1, 2, ···, n个队列中运行，<strong>随着优先级下降，分配的时间片长度增加，减少了抢占次数，不会发生长进程饥饿</strong></li>
</ul>
<p><img src="FB_q=1.png" srcset="/img/loading.gif" lazyload alt="示例" /><br />
<strong>平均周转时间</strong> = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mn>4</mn><mo>+</mo><mn>18</mn><mo>+</mo><mn>12</mn><mo>+</mo><mn>13</mn><mo>+</mo><mn>3</mn></mrow><mn>5</mn></mfrac><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">\frac{4+18+12+13+3}{5}=10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mord mtight">8</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mord mtight">2</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mord mtight">3</span><span class="mbin mtight">+</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span></span></span></span>，<strong>平均带权周转时间</strong> = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mfrac><mn>4</mn><mn>3</mn></mfrac><mo>+</mo><mfrac><mn>18</mn><mn>6</mn></mfrac><mo>+</mo><mfrac><mn>12</mn><mn>4</mn></mfrac><mo>+</mo><mfrac><mn>13</mn><mn>5</mn></mfrac><mo>+</mo><mfrac><mn>3</mn><mn>2</mn></mfrac></mrow><mn>5</mn></mfrac><mo>=</mo><mn>2.29</mn></mrow><annotation encoding="application/x-tex">\frac{\frac{4}{3}+\frac{18}{6}+\frac{12}{4}+\frac{13}{5}+\frac{3}{2}}{5}=2.29</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.48682em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.14182em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5508em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">.</span><span class="mord">2</span><span class="mord">9</span></span></span></span><br />
<img src="FB_q=2i.png" srcset="/img/loading.gif" lazyload alt="示例" /><br />
<strong>平均周转时间</strong> = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mn>4</mn><mo>+</mo><mn>15</mn><mo>+</mo><mn>14</mn><mo>+</mo><mn>14</mn><mo>+</mo><mn>6</mn></mrow><mn>5</mn></mfrac><mo>=</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">\frac{4+15+14+14+6}{5}=8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mord mtight">5</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mord mtight">4</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mord mtight">4</span><span class="mbin mtight">+</span><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span>，<strong>平均带权周转时间</strong> = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mfrac><mn>4</mn><mn>3</mn></mfrac><mo>+</mo><mfrac><mn>15</mn><mn>6</mn></mfrac><mo>+</mo><mfrac><mn>14</mn><mn>4</mn></mfrac><mo>+</mo><mfrac><mn>14</mn><mn>5</mn></mfrac><mo>+</mo><mfrac><mn>6</mn><mn>2</mn></mfrac></mrow><mn>5</mn></mfrac><mo>=</mo><mn>2.63</mn></mrow><annotation encoding="application/x-tex">\frac{\frac{4}{3}+\frac{15}{6}+\frac{14}{4}+\frac{14}{5}+\frac{6}{2}}{5}=2.63</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.48682em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.14182em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5508em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">.</span><span class="mord">6</span><span class="mord">3</span></span></span></span></p>
<h3 id="实时系统与实时调度"><a class="markdownIt-Anchor" href="#实时系统与实时调度"></a> 实时系统与实时调度</h3>
<h4 id="实时系统"><a class="markdownIt-Anchor" href="#实时系统"></a> 实时系统</h4>
<p>实时系统要求系统能够<strong>及时(即时)响应外部事件的请求</strong>，在<strong>规定的时间内完成</strong>对该事件的处理，并控制所有实时任务协调一致地运行</p>
<p>实时任务: 具有<strong>及时性要求</strong>的、常常<strong>被重复执行</strong>的特定进程，在实时系统中习惯称为任务</p>
<p><a href="#%E8%B0%83%E5%BA%A6%E6%A0%87%E5%87%86">调度标准</a>中有一个标准为<strong>截止时间</strong>，在实时系统中截止时间分为2类:</p>
<ul>
<li>开始截止时间: 任务在某时间以前，必须开始执行</li>
<li>完成截止时间: 任务在某时间以前必须完成</li>
</ul>
<p><img src="real_time_task.png" srcset="/img/loading.gif" lazyload alt="实时任务分类" /></p>
<p>实时任务的<strong>信息</strong>:</p>
<ul>
<li>就绪时间</li>
<li>开始截止时间</li>
<li>完成截止时间</li>
<li>处理时间</li>
<li>资源需求</li>
<li>优先级</li>
<li>子任务结构: 一个任务可分解为<strong>一个必须执行的子任务</strong>和一个可选执行子任务，<strong>前者有硬截止时间</strong></li>
</ul>
<p>实时操作系统<strong>特点</strong>:</p>
<ul>
<li><strong>可确定性</strong>: 任务按照<strong>固定的、预先确定的时间</strong>或时间间隔进行</li>
<li><strong>可响应性</strong>: 关注系统在知道中断后<strong>为中断提供服务的时间</strong></li>
<li><strong>用户控制</strong>: 用户能够区分软、硬实时任务，并<strong>控制任务优先级</strong></li>
<li><strong>可靠性</strong>: 实时响应和控制事件，保障性能</li>
<li><strong>失效弱化</strong>: 系统具有稳定性，当不能满足所有任务的实时性时，首先满足优先级高的任务</li>
</ul>
<h4 id="实时调度"><a class="markdownIt-Anchor" href="#实时调度"></a> 实时调度</h4>
<p>实时调度从2个角度进行分类:</p>
<ul>
<li><strong>调度方法</strong></li>
<li><strong>抢占方式</strong></li>
</ul>
<h5 id="调度方法"><a class="markdownIt-Anchor" href="#调度方法"></a> 调度方法</h5>
<ul>
<li><strong>静态表驱动</strong>调度法</li>
<li><strong>静态优先级抢占</strong>调度法</li>
<li><strong>基于动态规划</strong>的调度法</li>
<li><strong>动态尽力</strong>调度法</li>
</ul>
<p><strong>静态表驱动调度法</strong><br />
制订<strong>静态调度表</strong>(即固定时间执行固定进程)，用于调度<strong>周期性实时任务</strong><br />
任何任务的调度<strong>申请改动都会引起调度表的修改</strong></p>
<p><strong>EDF(Early Deadline First)调度算法</strong>即是属于静态表驱动调度法<br />
说明: 根据任务的截止时间来确定任务的优先级</p>
<p><img src="edf_example_question.png" srcset="/img/loading.gif" lazyload alt="示例" /><br />
<img src="edf_example_answer.png" srcset="/img/loading.gif" lazyload alt="示例" /></p>
<p><strong>静态优先级抢占调度法</strong><br />
<strong>根据任务的时间约束确定优先级从而根据优先级进行抢占调度</strong>，多用于非实时多道程序系统</p>
<p><strong>速度单调算法(RM,Rate Monotonic)<strong>即是根据</strong>任务周期长度</strong>为实时任务赋予<strong>静态优先级</strong><br />
说明: 任务周期越短，优先级越高，优先级函数是<strong>任务速度(任务周期的倒数)<strong>的单调</strong>递增</strong>的函数</p>
<p><img src="RM.png" srcset="/img/loading.gif" lazyload alt="速率与优先级" /></p>
<p><strong>基于动态规划的调度法</strong><br />
当实时任务到达以后，系统为新到达的任务和正在执行的任务<strong>动态创建一张调度表</strong><br />
说明: 在<strong>当前执行进程不会错过其截止时间的条件下</strong>，如果也能<strong>使新到达任务在截止时间内完成，则立即调度执行新任务</strong></p>
<p><strong>动态尽力调度法</strong><br />
当任务到达时，系统<strong>根据其属性赋予优先级</strong>，优先级高的先调度<br />
当任务是非周期时，其缺点在于<strong>当任务完成，或截止时间到达时，很难知道该任务是否满足其约束时间</strong></p>
<p><strong>允许CPU空闲的EDF</strong><br />
说明: 优先调度<strong>截止时间最早的还未就绪但是已知道其开始截止时间任务</strong>，并让该任务运行完毕</p>
<p><img src="edf_idle_time_question.png" srcset="/img/loading.gif" lazyload alt="示例" /><br />
<img src="edf_idle_time_answer.png" srcset="/img/loading.gif" lazyload alt="示例" /></p>
<h5 id="抢占方式"><a class="markdownIt-Anchor" href="#抢占方式"></a> 抢占方式</h5>
<ul>
<li><strong>基于时间片</strong>的轮转抢占式调度</li>
<li><strong>基于优先级</strong>的<strong>非抢占式</strong>调度</li>
<li><strong>基于优先级</strong>的抢<strong>占点抢占</strong>调度</li>
<li><strong>立即抢占式</strong>调度</li>
</ul>
<p><img src="preemption.png" srcset="/img/loading.gif" lazyload alt="抢占方式" /></p>
<h2 id="同步"><a class="markdownIt-Anchor" href="#同步"></a> 同步</h2>
<p>进程间有以下三种关系:<br />
<b></p>
<ul>
<li>竞争</li>
<li>通过共享合作</li>
<li>通过通信合作</li>
</ul>
</b>
<p><strong>竞争</strong>: 进程间不知道彼此的存在，竞争使用同一资源时会发生冲突，竞争面对的并发控制问题为<strong>互斥、死锁、饥饿</strong><br />
<strong>通过共享合作</strong>: 多个进程可能共享一个变量、共享文件或数据库，共享面对的并发控制问题为<strong>互斥、死锁、饥饿、数据一致性</strong><br />
<strong>通过通信合作</strong>: 进程间通过通信完成同步和协调彼此活动，通信面对的并发控制问题为<strong>互斥、死锁</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center"><strong>术语</strong></th>
<th style="text-align:center"><strong>解释</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>原子操作</strong></td>
<td style="text-align:center">由一个或多个指令序列实现的动作或函数，对外不可见，一组指令要么都执行，要么都不执行</td>
</tr>
<tr>
<td style="text-align:center"><strong>临界资源</strong></td>
<td style="text-align:center"><strong>不可同时访问</strong>，必须互斥访问的资源，如打印机</td>
</tr>
<tr>
<td style="text-align:center"><strong>临界区</strong></td>
<td style="text-align:center">访问临界资源的<strong>代码</strong>，任意时刻只能由一个进程在这段代码中运行</td>
</tr>
<tr>
<td style="text-align:center"><strong>互斥</strong></td>
<td style="text-align:center">当一个进程在临界区访问共享资源时，其他进程不能进入该临界区访问共享资源的情形</td>
</tr>
<tr>
<td style="text-align:center"><strong>活锁</strong></td>
<td style="text-align:center">两个或两个以上的进程为响应其他进程而<strong>持续改变自己状态</strong>，<strong>但是不做有用工作的情形</strong></td>
</tr>
<tr>
<td style="text-align:center"><strong>死锁</strong></td>
<td style="text-align:center">两个或两个以上的进程因<strong>等待其他进程做完某些事</strong>而<strong>不能继续执行的情形</strong></td>
</tr>
<tr>
<td style="text-align:center"><strong>竞争条件</strong></td>
<td style="text-align:center">多个进程或线程读写共享的数据时，结果取决于多个进程的指令执行顺序</td>
</tr>
<tr>
<td style="text-align:center"><strong>饥饿</strong></td>
<td style="text-align:center"><strong>一个具备执行条件的进程，被调度程序无限期的忽视而不能调度的情形</strong></td>
</tr>
</tbody>
</table>
<h3 id="并发"><a class="markdownIt-Anchor" href="#并发"></a> 并发</h3>
<p>并发指同一时间多个进程需要执行，并发处理为<strong>单处理器的交替执行</strong>和<strong>多处理器的重叠执行</strong><br />
但是由于进程是计算机中的独立个体，且具有<strong>异步性、并发性</strong>，并且需要<strong>共享资源稀缺</strong>，并发控制需要进程间的同步来实现</p>
<p><img src="concurrency_1.png" srcset="/img/loading.gif" lazyload alt="单处理器并发错误" /><br />
如上图所示: 在P1输入x后，CPU接受到中断，在中断处理后调度了P2，按图示顺序进行执行，则<strong>P1输入为x, 输出为y</strong></p>
<p><img src="concurrency_1.png" srcset="/img/loading.gif" lazyload alt="多处理器并发错误" /><br />
P1和P2分别在单独的处理器上执行，同一行的事件并行，<strong>P1输入为x, 输出为y</strong></p>
<p>因此OS需要提供并发控制的方法</p>
<h3 id="互斥"><a class="markdownIt-Anchor" href="#互斥"></a> 互斥</h3>
<p><strong>互斥: 当一个进程在临界区访问共享资源时，其他进程不能进入该临界区访问共享资源的情形</strong></p>
<p><span style="color:#ff562b"><b>互斥的要求(访问临界区的要求): </b></span></p>
<ul>
<li><strong>空闲让进</strong>: 如临界区空闲，则有进程申请就立即进入</li>
<li><strong>忙则等待</strong>: 每次只允许一个进程处于临界区</li>
<li><strong>有限等待</strong>: 保证进程在有限时间内能进入临界区</li>
<li><strong>让权等待</strong>: 进程在临界区不能长时间阻塞等待某事件</li>
</ul>
<h3 id="实现进程互斥的方法"><a class="markdownIt-Anchor" href="#实现进程互斥的方法"></a> 实现进程互斥的方法</h3>
<h4 id="软件方法"><a class="markdownIt-Anchor" href="#软件方法"></a> 软件方法</h4>
<p>软件方法是通过<strong>在进入区设置和检查一些标志来判断是否有进程在临界区</strong>，若已有进程在临界区，则在进入区通过循环检查进行等待，进程离开临界区后在退出区修改标志</p>
<p>思想:</p>
<ul>
<li>临界区状态标志</li>
<li>预先表明进入临界区的态度(谦让/坚持进入)</li>
</ul>
<p>软件方法的<strong>评价</strong>:</p>
<ul>
<li>软件方法始终不能解决<strong>忙等</strong>现象，降低系统效率</li>
<li>采用软件方法实现进程互斥使用临界资源比较困难，特别是<strong>多个进程的互斥</strong></li>
<li>算法设计需要非常小心，否则可能出现<strong>死锁</strong>、<strong>互斥失败</strong>等严重问题</li>
</ul>
<h5 id="dekker算法"><a class="markdownIt-Anchor" href="#dekker算法"></a> Dekker算法</h5>
<p>Dekker算法思路:<br />
当p0希望进入自己的临界区时，它把自己的flag值设为true，然后继续 检查P1的flag，如果P1的flag为false,P0可以立即进入自己的临界区，否则 P0检查turn,如果发现turn=0，那么它知道自己该坚持进入，从而周期性的检查P1的flag，P1在某一点将注意到应把turn值赋为0，随后把其flag置为false,允许P0进入，在P0结束其临界区后，把自己的flag置为false。释放其临界区，并把turn值置为1，从而把坚持进入的权利转交给P1</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c">boolean flag[<span class="hljs-number">2</span>] = &#123;<span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>&#125;;        <span class="hljs-comment">// 临界区状态标志(共享的全局变量)</span><br><span class="hljs-type">int</span> turn = <span class="hljs-number">1</span>;                            <span class="hljs-comment">// 进入临界区的态度</span><br><span class="hljs-comment">// 进程P0</span><br><span class="hljs-keyword">do</span> &#123;<br>    flag[<span class="hljs-number">0</span>] = <span class="hljs-literal">true</span>;                      <span class="hljs-comment">// 进入区</span><br>    <span class="hljs-keyword">while</span> (flag[<span class="hljs-number">1</span>]) &#123;                    <span class="hljs-comment">// P1正在使用或者P1也想使用</span><br>       <span class="hljs-keyword">if</span> (turn == <span class="hljs-number">1</span>)  &#123;<br>           flag[<span class="hljs-number">0</span>] = <span class="hljs-literal">false</span>;<br>           <span class="hljs-keyword">while</span>  (turn == <span class="hljs-number">1</span>) ;          <span class="hljs-comment">// 轮到P1使用，退让直到轮到P0使用</span><br>           flag[<span class="hljs-number">0</span>] = <span class="hljs-literal">true</span>;<br>        &#125;<br>     &#125;                                   <span class="hljs-comment">// P1退让或P1使用完，P0进入临界区</span><br>    进程P0的临界区代码；                  <span class="hljs-comment">// 使用临界区</span><br>    turn = <span class="hljs-number">1</span>;<br>    flag[<span class="hljs-number">0</span>] = <span class="hljs-literal">false</span>;                    <span class="hljs-comment">// 退出区</span><br>    进程P0的其它代码                     <span class="hljs-comment">// 剩余区</span><br>&#125; <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br><br><span class="hljs-comment">// 进程P1</span><br><span class="hljs-keyword">do</span> &#123;<br>    flag[<span class="hljs-number">1</span>] = <span class="hljs-literal">true</span>;                      <span class="hljs-comment">// 进入区</span><br>    <span class="hljs-keyword">while</span> (flag[<span class="hljs-number">0</span>]) &#123;                    <span class="hljs-comment">// P0正在使用或者P0也想使用</span><br>       <span class="hljs-keyword">if</span> (turn == <span class="hljs-number">0</span>)  &#123;<br>           flag[<span class="hljs-number">1</span>] = <span class="hljs-literal">false</span>;<br>           <span class="hljs-keyword">while</span>  (turn == <span class="hljs-number">0</span>) ;          <span class="hljs-comment">// 轮到P0使用，退让直到轮到P1使用</span><br>           flag[<span class="hljs-number">1</span>] = <span class="hljs-literal">true</span>;<br>        &#125;<br>     &#125;                                   <span class="hljs-comment">// P0退让或P0使用完，P1进入临界区</span><br>    进程P1的临界区代码；                  <span class="hljs-comment">// 使用临界区</span><br>    turn = <span class="hljs-number">0</span>;<br>    flag[<span class="hljs-number">1</span>] = <span class="hljs-literal">false</span>;                    <span class="hljs-comment">// 退出区</span><br>    进程P1的其它代码                     <span class="hljs-comment">// 剩余区</span><br>&#125; <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br></code></pre></td></tr></table></figure>
<h5 id="peterson算法"><a class="markdownIt-Anchor" href="#peterson算法"></a> Peterson算法</h5>
<p>Peterson算法思路:<br />
考虑进程P0,一旦它把flag[0]置为true，P1不能进入其临界区，如果P1已经在临界区中，则flag[1]=true，P0被阻止进入临界区。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c">boolean flag[<span class="hljs-number">2</span>] = &#123;<span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>&#125;;        <span class="hljs-comment">// 临界区状态标志(共享的全局变量)</span><br><span class="hljs-type">int</span> turn = <span class="hljs-number">1</span>;                            <span class="hljs-comment">// 进入临界区的态度</span><br><span class="hljs-comment">// 进程P0</span><br><span class="hljs-keyword">do</span> &#123;<br>    flag[<span class="hljs-number">0</span>] = <span class="hljs-literal">true</span>;                      <span class="hljs-comment">// 表明想要使用</span><br>    turn = <span class="hljs-number">1</span>;                            <span class="hljs-comment">// 谦让P1</span><br>    <span class="hljs-keyword">while</span> (flag[<span class="hljs-number">1</span>] &amp;&amp; turn == <span class="hljs-number">1</span>);        <span class="hljs-comment">// 等待P1使用完并谦让给P0</span><br>    进程P0的临界区代码；                  <span class="hljs-comment">// 使用临界区</span><br>    flag[<span class="hljs-number">0</span>] = <span class="hljs-literal">false</span>;                     <span class="hljs-comment">// 退出区</span><br>    进程P0的其它代码                     <span class="hljs-comment">// 剩余区</span><br>&#125; <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br><span class="hljs-comment">// 进程P1</span><br><span class="hljs-keyword">do</span> &#123;<br>    flag[<span class="hljs-number">1</span>] = <span class="hljs-literal">true</span>;                      <span class="hljs-comment">// 表明想要使用</span><br>    turn = <span class="hljs-number">0</span>;                            <span class="hljs-comment">// 谦让P0</span><br>    <span class="hljs-keyword">while</span> (flag[<span class="hljs-number">0</span>] &amp;&amp; turn == <span class="hljs-number">0</span>);        <span class="hljs-comment">// 等待P1使用完并谦让给P0</span><br>    进程P0的临界区代码；                  <span class="hljs-comment">// 使用临界区</span><br>    flag[<span class="hljs-number">1</span>] = <span class="hljs-literal">false</span>;                     <span class="hljs-comment">// 退出区</span><br>    进程P1的其它代码                     <span class="hljs-comment">// 剩余区</span><br>&#125; <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br></code></pre></td></tr></table></figure>
<h4 id="硬件方法"><a class="markdownIt-Anchor" href="#硬件方法"></a> 硬件方法</h4>
<p>硬件方法也主要有<strong>2种</strong>:</p>
<ul>
<li><strong>中断禁用</strong></li>
<li><strong>特殊机器指令</strong></li>
</ul>
<h5 id="中断禁用"><a class="markdownIt-Anchor" href="#中断禁用"></a> 中断禁用</h5>
<p>中断禁用可以解决<strong>单处理器情况下</strong>由<strong>中断引起的并发错误</strong>，但<strong>不能解决多处理器下的互斥问题</strong><br />
<strong>通过禁用中断，避免进程切换，实现互斥访问</strong></p>
<p>但是会造成很多<strong>弊端</strong>:</p>
<ul>
<li>无法响应外部请求</li>
<li>无法切换进程</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span> ) &#123;<br>  disable interrupt    <span class="hljs-comment">// 屏蔽中断</span><br>  critical section     <span class="hljs-comment">// 临界区</span><br>  enable interrupt     <span class="hljs-comment">// 启用中断</span><br>  remainder            <span class="hljs-comment">// 其余部分</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="特殊机器指令"><a class="markdownIt-Anchor" href="#特殊机器指令"></a> 特殊机器指令</h5>
<p>特殊机器指令由一条机器指令完成，因此不会被中断或多处理器并发指令影响<br />
<b></p>
<p>优点:</p>
<ul>
<li>支持多处理器</li>
<li>简单、易证明</li>
<li>支持多临界区</li>
</ul>
<p>缺点:</p>
<ul>
<li>忙等</li>
<li>可能饥饿</li>
<li>可能死锁</li>
</ul>
</b>
<p>这里只介绍其中2条特殊机器指令<br />
<b>compare_and_swap()</b>指令: <strong>比较一个内存单元的值和一个测试值，如果相等，则发生交换</strong><br />
实现的功能与下面这个函数相同</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">compare_and_swap</span><span class="hljs-params">(<span class="hljs-type">int</span> *word, <span class="hljs-type">int</span> testval, <span class="hljs-type">int</span> newval)</span> &#123;<br>  <span class="hljs-type">int</span> oldval; <br>  oldval = *word;<br>  <span class="hljs-keyword">if</span>(oldval == testval) *word = newval;<br>  <span class="hljs-keyword">return</span> oldval;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><b>exchange()</b>指令: <strong>原子性地交换寄存器和内存的值</strong><br />
实现的功能与下面这个函数相同</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">exchange</span><span class="hljs-params">(<span class="hljs-type">int</span> *a, <span class="hljs-type">int</span> *b)</span> &#123;<br>  <span class="hljs-type">int</span> tmp;<br>  tmp = *a;<br>  *a = *b;<br>  *b = tmp;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="信号量"><a class="markdownIt-Anchor" href="#信号量"></a> 信号量</h4>
<p><span style="color:#ff562b"><b>信号量是实现进程互斥的最主要方法！</b></span></p>
<p>信号量: <strong>两个或多个进程可以通过传递信号进行合作</strong>，<strong>迫使进程在某个位置暂时停止执行(阻塞)</strong>，直到<strong>它收到一个可以向前推进的信号(唤醒)</strong>，<strong>通过对信号量操作的原子化即可实现进程互斥</strong></p>
<p><strong>信号量可视为一个值为整数的变量</strong>，有且仅有具有三个操作:</p>
<ul>
<li>初始化: 可以初始化为非负数</li>
<li>semWait(Wait或P): 使信号量的值<strong>减少1</strong>，若值<strong>变为负数</strong>，则<strong>阻塞执行semWait(Wait或P)操作的进程</strong></li>
<li>semSignal(Signal或V): 使信号量的值<strong>增加1</strong>，若<strong>值小于等于零(说明有进程在等待增加)，则被semWait(Wait或P)阻塞的进程解除阻塞</strong></li>
</ul>
<p><strong>其中信号量可以是二元信号量(只能为0和1)和计数信号量(一般信号量，整数)</strong></p>
<p>计数信号量和二元信号量，都使用<strong>队列</strong>来组织<strong>等待信号量</strong>的进程:</p>
<ul>
<li><strong>强信号量</strong>: 进程以<strong>FIFO(First In First Out)方式</strong>从队列里移除</li>
<li><strong>弱信号量</strong>: 未规定阻塞进程从队列里移除的顺序</li>
</ul>
<p><img src="signal.png" srcset="/img/loading.gif" lazyload alt="强信号量示例" /></p>
<h4 id="管程"><a class="markdownIt-Anchor" href="#管程"></a> 管程</h4>
<p>信号量提供了方便的机制处理进程同步，但<strong>不正确的使用信号量仍会导致时序错误(死锁)</strong>，且难以检测:</p>
<ul>
<li>先对信号量<code>V()</code>再<code>P()</code>违反了互斥请求</li>
<li>对信号量始终调用<code>P()</code>将导致死锁</li>
<li>一个进程遗漏了<code>P()</code>或<code>V()</code>将导致死锁且可能破坏互斥</li>
</ul>
<p>管程(monitor)类型提供了一组由程序员定义的、在管程内互斥的操作。<strong>管程内定义的子程序只能访问位于管程内的局部变量和形式参数</strong>，管程内的局部变量也只能被管程内部的局部子程序访问，管程结构确保了<strong>同时只能有一个进程在管程内活动</strong></p>
<p>管程内部可定义<code>condition</code>类型的变量以提供同步机制，称其为<strong>条件变量</strong>。条件变量可执行操作<code>wait()</code>和<code>signal()</code><br />
条件变量存在于管程内部，对同一个条件变量调用操作的进程将和条件变量建立一定的联系，或者称之为绑定。对于管程内的条件变量 x，进程 P调用<code>x.wait()</code>将时<strong>自身挂起到条件变量x上</strong>；当另一个进程调用<code>x.signal()</code>时，在x上<strong>悬挂的进程会被重启</strong>，如果此时没有进程悬挂在x上，则<code>x.signal()</code><strong>操作将被忽略</strong></p>
<p><img src="monitor.png" srcset="/img/loading.gif" lazyload alt="管程结构图" /></p>
<p>进程P调用<code>x.signal()</code>，且存在悬挂进程Q与条件变量x关联，根据管程的性质，若进程Q开始执行，则进程P必须等待</p>
<ul>
<li><strong>进程Q重启且进程P等待</strong>: 进程P将等待，<strong>直到进程Q离开管程</strong>或者<strong>等待另一个进程调用</strong><code>x.signal()</code></li>
<li><strong>进程P唤醒进程Q且进程P继续执行</strong>：进程Q被唤醒，但<strong>仍然会等待</strong>，<strong>直到进程P离开管程</strong>，或者另一个触发条件<code>x.wait()</code></li>
</ul>
<p><strong>信号量实现管程</strong>:<br />
进入管程的外部子程序结构F如下:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">F</span><span class="hljs-params">()</span> &#123;<br>  wait(mutex);<br>  <span class="hljs-comment">// 子程序执行</span><br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-comment">// 子程序执行结束</span><br>  <span class="hljs-keyword">if</span> (next_count &gt; <span class="hljs-number">0</span>) &#123;<br>    signal(next);    <span class="hljs-comment">//     此前有进程挂起，重启该进程</span><br>  &#125;<br>  <span class="hljs-keyword">else</span> &#123;<br>    signal(mutex);   <span class="hljs-comment">//     管程内无进程挂起，释放控制权</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>对每个管程内的条件变量 x，引入信号量 x_sem 和整数变量 x_count 记录信号量 x 上挂起的进程数量，均初始化为 0。x.wait() 和 x.signal() 实现如下:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> x.wait()&#123;<br>  x_count++;               <span class="hljs-comment">// 将进程挂起到 x 上</span><br>  <span class="hljs-keyword">if</span> (next_count &gt; <span class="hljs-number">0</span>) &#123;    <span class="hljs-comment">// 当前仍有进程挂起在管程中</span><br>    signal(next);<br>  &#125;<br>  <span class="hljs-keyword">else</span> &#123;<br>    signal(mutex);         <span class="hljs-comment">// 无进程在等待，释放管程控制权</span><br>  &#125;<br>  wait(x_sem);             <span class="hljs-comment">// 等待信号量 x_sem，由信号量决定唤醒哪个挂起进程</span><br>  x_count--;               <span class="hljs-comment">// 等待结束，进程被唤醒</span><br>&#125;<br><br><span class="hljs-type">void</span> x.signal()&#123;<br>  <span class="hljs-keyword">if</span> (x_count &gt; <span class="hljs-number">0</span>) &#123;     <span class="hljs-comment">// 当前有程序挂起在条件变量 x</span><br>      next_count ++;     <span class="hljs-comment">// 自己将要被阻塞，故管程挂起数增加</span><br>      signal(x_sem);     <span class="hljs-comment">// 释放信号量，唤醒一个挂起进程</span><br>      wait(next);        <span class="hljs-comment">// 将自身阻塞到管程中</span><br>      next_count--;      <span class="hljs-comment">// 被唤醒，继续执行</span><br>  &#125;<br>  <span class="hljs-comment">// 没有程序挂起在条件变量 x，不产生任何影响</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="消息传递"><a class="markdownIt-Anchor" href="#消息传递"></a> 消息传递</h4>
<p>消息传递的<strong>2条通信原语</strong>:</p>
<ul>
<li>Send</li>
<li>Receive</li>
</ul>
<p><img src="message_format.png" srcset="/img/loading.gif" lazyload alt="消息格式" /></p>
<p>消息传递的<strong>3种同步方式</strong>:<br />
<b></p>
<ul>
<li>阻塞发送，阻塞接收</li>
<li>不阻塞发送，阻塞接收</li>
<li>不阻塞发送，不阻塞接收</li>
</ul>
</b>
<p><strong>使用消息传递实现互斥</strong></p>
<ul>
<li>多个并发执行的发送进程和接收进程共享一个邮箱box，且box的<strong>初始状态为仅包含一条空消息</strong>(好比进入临界区的令牌)</li>
<li>采用<strong>不阻塞发送，阻塞接收</strong>方式传递消息</li>
<li>若邮箱中存在一条消息，则允许一个进程进入临界区</li>
<li>若邮箱为空，则表明有一个进程位于临界区，其它试图进入临界区的进程必须阻塞</li>
<li><strong>只要保证邮箱中最多只有一条消息，就能保证只允许一个进程进入临界区，从而实现进程互斥使用临界资源</strong></li>
</ul>
<p><span style="color:#ff562b"><b>接收即为申请进入临界区，发送即退出临界区</b></span></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">P</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>  message msg;<br>  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>    receive(box, msg);    <span class="hljs-comment">/* 从邮箱接收一条消息 */</span><br>    &lt;临界区&gt;;<br>    send(box, msg);       <span class="hljs-comment">/*　将消息发回到邮箱　*/</span><br>    &lt;其余部分&gt;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="互斥问题"><a class="markdownIt-Anchor" href="#互斥问题"></a> 互斥问题</h3>
<p>均通过信号量方法来进行解决</p>
<h4 id="生产者与消费者问题"><a class="markdownIt-Anchor" href="#生产者与消费者问题"></a> 生产者与消费者问题</h4>
<p>问题描述:</p>
<ul>
<li><strong>一个或多个生产者产生数据并放入缓冲</strong></li>
<li><strong>每次只能有一个消费者从缓冲中取出数据(互斥)</strong></li>
<li><strong>任何时刻只能由一个生产者或消费者访问缓冲(互斥)</strong></li>
</ul>
<p>同步问题:</p>
<ul>
<li><strong>缓冲区满时，生产者不会往缓冲区增加数据</strong></li>
<li><strong>缓冲区空时，消费者不能从缓冲区中取走数据</strong></li>
</ul>
<p>翻译为流程图形式:<br />
<img src="producers_consumers.png" srcset="/img/loading.gif" lazyload alt="生产者与消费者问题" /><br />
一般需要表示<strong>可用资源的信号量、可放资源的信号量、保护放入资源和取出资源操作的信号量</strong><br />
<span style="color:#ff562b"><b>应先申请资源信号量，再申请操作互斥信号量</b></span></p>
<p>例题:</p>
<ul>
<li>桌子上有一只盘子，最多可以放入N(N&gt;0)个水果</li>
<li>爸爸随机向盘中放入苹果或桔子，儿子只吃盘中的桔子，女儿只吃盘中的苹果</li>
<li>仅当盘子中有自己需要的水果时，儿子或女儿才可以从盘子中取出相应的水果</li>
<li>每次只能放入或取出一个水果，且不允许多人同时使用盘子</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c">semaphore plate = N;      <span class="hljs-comment">// 盘子可放水果数，初始为N</span><br>semaphore apple = <span class="hljs-number">0</span>;      <span class="hljs-comment">// 盘中里的苹果数，初始为0</span><br>semaphore orange = <span class="hljs-number">0</span>;     <span class="hljs-comment">// 盘中里的桔子数，初始为0</span><br>semaphore plate_op = <span class="hljs-number">1</span>;   <span class="hljs-comment">// 盘中操作的信号量，初始为1</span><br><br>dad() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    fruit = fruit();    <span class="hljs-comment">// 准备水果，并且得到水果类型</span><br>    P(plate);           <span class="hljs-comment">// 申请放水果</span><br>    P(plate_op);        <span class="hljs-comment">// 申请使用盘子</span><br>    放水果              <span class="hljs-comment">// 放水果</span><br>    V(plate_op);        <span class="hljs-comment">// 释放盘子使用权</span><br>    <span class="hljs-keyword">if</span> (fruit == <span class="hljs-string">&#x27;apple&#x27;</span>) &#123;<br>      V(apple);         <span class="hljs-comment">// 如果放了苹果，则苹果数增加</span><br>    &#125;<br>    <span class="hljs-keyword">if</span> (fruit == <span class="hljs-string">&#x27;orange&#x27;</span>) &#123;<br>      V(orange);         <span class="hljs-comment">// 如果放了桔子，则桔子数增加</span><br>    &#125;<br>  &#125;<br>&#125;<br><br>son() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(orange);          <span class="hljs-comment">// 申请吃桔子</span><br>    P(plate_op);        <span class="hljs-comment">// 申请使用盘子</span><br>    拿桔子吃            <span class="hljs-comment">// 吃桔子</span><br>    V(plate_op);       <span class="hljs-comment">// 释放盘子使用权</span><br>    V(plate);           <span class="hljs-comment">// 可放水果数增加</span><br>  &#125;<br>&#125;<br><br>daught() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(apple);          <span class="hljs-comment">// 申请吃苹果</span><br>    P(plate_op);        <span class="hljs-comment">// 申请使用盘子</span><br>    拿苹果吃            <span class="hljs-comment">// 吃苹果</span><br>    V(plate_op);       <span class="hljs-comment">// 释放盘子使用权</span><br>    V(plate);           <span class="hljs-comment">// 可放水果数增加</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li>桌子上有一只盘子，爸爸负责向盘中放苹果，妈妈负责向盘中放桔子</li>
<li>儿子只吃盘中的桔子，女儿只吃盘中的苹果</li>
<li>只有盘子为空时，爸爸或妈妈才可以向盘子中放入一个水果</li>
<li>仅当盘子中有自己需要的水果时，儿子或女儿才可以从盘子中取出相应的水果</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs c">semaphore can_put = <span class="hljs-number">1</span>;      <span class="hljs-comment">// 可以放水果的数量(放了一个后不准放等价于只有空的时候才能放)，初始为1</span><br>semaphore apple = <span class="hljs-number">0</span>;        <span class="hljs-comment">// 盘中里的苹果数，初始为0</span><br>semaphore orange = <span class="hljs-number">0</span>;       <span class="hljs-comment">// 盘中里的桔子数，初始为0</span><br>semaphore plate_op = <span class="hljs-number">1</span>;     <span class="hljs-comment">// 盘中操作的信号量，初始为1</span><br><br>dad() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(can_put);         <span class="hljs-comment">// 申请放水果</span><br>    P(plate_op);        <span class="hljs-comment">// 申请盘子使用权</span><br>    放苹果              <span class="hljs-comment">// 放苹果</span><br>    V(plate_op);        <span class="hljs-comment">// 释放盘子使用权</span><br>    V(apple);           <span class="hljs-comment">// 苹果数增加</span><br>  &#125;<br>&#125;<br><br>mom() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(can_put);       <span class="hljs-comment">// 申请放水果</span><br>    P(plate_op);      <span class="hljs-comment">// 申请盘子使用权</span><br>    放桔子            <span class="hljs-comment">// 放桔子</span><br>    V(plate_op);      <span class="hljs-comment">// 释放盘子使用权</span><br>    V(orange);        <span class="hljs-comment">// 桔子数增加</span><br>  &#125;<br>&#125;<br><br>son() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(orange);          <span class="hljs-comment">// 申请吃桔子</span><br>    P(plate_op);        <span class="hljs-comment">// 申请盘子使用权</span><br>    拿桔子吃            <span class="hljs-comment">// 拿桔子吃 </span><br>    V(plate_op);        <span class="hljs-comment">// 释放盘子使用权</span><br>    V(can_put);         <span class="hljs-comment">// 可以放水果</span><br>  &#125;<br>&#125;<br><br>daught() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(apple);          <span class="hljs-comment">// 申请吃苹果</span><br>    P(plate_op);        <span class="hljs-comment">// 申请盘子使用权</span><br>    拿苹果吃            <span class="hljs-comment">// 拿苹果吃 </span><br>    V(plate_op);        <span class="hljs-comment">// 释放盘子使用权</span><br>    V(can_put);         <span class="hljs-comment">// 可以放水果</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li>桌子上有一只盘子，最多可以放入2个水果</li>
<li>爸爸负责向盘中放苹果，妈妈负责向盘中放桔子，女儿负责取出并消费水果，放入者和取出者不允许同时使用盘子</li>
<li>当且仅当盘子中同时存在苹果和桔子时，女儿才从盘子中取出并消费水果</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c">semaphore can_put_apple = <span class="hljs-number">1</span>;    <span class="hljs-comment">// 最多放一个苹果</span><br>semaphore can_put_apple = <span class="hljs-number">1</span>;    <span class="hljs-comment">// 最多放一个苹果</span><br>semaphore apple = <span class="hljs-number">0</span>;            <span class="hljs-comment">// 盘中里的苹果数，初始为0</span><br>semaphore orange = <span class="hljs-number">0</span>;           <span class="hljs-comment">// 盘中里的桔子数，初始为0</span><br>semaphore plate_op = <span class="hljs-number">1</span>;         <span class="hljs-comment">// 盘中操作的信号量，初始为1</span><br><br>dad() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(can_put_apple);         <span class="hljs-comment">// 申请放苹果</span><br>    P(plate_op);              <span class="hljs-comment">// 申请盘子使用权</span><br>    放苹果                    <span class="hljs-comment">// 放苹果</span><br>    V(plate_op);              <span class="hljs-comment">// 释放盘子使用权</span><br>    V(apple);                 <span class="hljs-comment">// 苹果数增加</span><br>  &#125;<br>&#125;<br><br>mom() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(can_put_orange);         <span class="hljs-comment">// 申请放桔子</span><br>    P(plate_op);              <span class="hljs-comment">// 申请盘子使用权</span><br>    放桔子                    <span class="hljs-comment">// 放桔子</span><br>    V(plate_op);              <span class="hljs-comment">// 释放盘子使用权</span><br>    V(orange);                 <span class="hljs-comment">// 桔子数增加</span><br>  &#125;<br>&#125;<br><br>daught() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(apple);               <span class="hljs-comment">// 申请苹果</span><br>    P(orange);              <span class="hljs-comment">// 申请桔子</span><br>    P(plate_op);            <span class="hljs-comment">// 申请盘子使用权</span><br>    拿苹果和桔子吃           <span class="hljs-comment">// 吃苹果和桔子</span><br>    V(plate_op);            <span class="hljs-comment">// 释放盘子使用权</span><br>    V(acan_put_apple);      <span class="hljs-comment">// 允许放苹果</span><br>    V(acan_put_orange);     <span class="hljs-comment">// 允许放桔子</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li>女儿负责画画，爸爸、妈妈负责欣赏</li>
<li>女儿在白板上画完一幅画后，请爸爸、妈妈均欣赏过一遍后，再创作新画</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c">semaphore dad_readed = <span class="hljs-number">1</span>;     <span class="hljs-comment">// 爸爸看过，初始为1</span><br>semaphore mom_readed = <span class="hljs-number">1</span>;     <span class="hljs-comment">// 妈妈看过，初始为1</span><br>semaphore dad_can_read = <span class="hljs-number">0</span>; <span class="hljs-comment">// 爸爸可以看了，初始为1</span><br>semaphore mom_can_read = <span class="hljs-number">0</span>; <span class="hljs-comment">// 妈妈可以看了，初始为1</span><br><br>daught() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(dad_readed);        <span class="hljs-comment">// 爸爸看过</span><br>    P(mom_readed);        <span class="hljs-comment">// 妈妈看过</span><br>    画画                <span class="hljs-comment">// 画画</span><br>    V(dad_can_read);    <span class="hljs-comment">// 爸爸可以看</span><br>    V(mom_can_read);    <span class="hljs-comment">// 妈妈可以看</span><br>  &#125;<br>&#125;<br><br>dad() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(dad_can_read);    <span class="hljs-comment">// 爸爸申请看</span><br>    看画                <span class="hljs-comment">// 看画</span><br>    V(dad_readeded);    <span class="hljs-comment">// 爸爸看完</span><br>  &#125;<br>&#125;<br><br>mom() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(mom_can_read);    <span class="hljs-comment">// 妈妈申请看</span><br>    看画                <span class="hljs-comment">// 看画</span><br>    V(mom_readeded);    <span class="hljs-comment">// 妈妈看完</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="读者与写者问题"><a class="markdownIt-Anchor" href="#读者与写者问题"></a> 读者与写者问题</h4>
<p><img src="reader_writer.png" srcset="/img/loading.gif" lazyload alt="问题描述图" /></p>
<p>读者与写者问题有<strong>3种解决策略</strong>:<br />
<b></p>
<ul>
<li>读者优先</li>
<li>写者优先</li>
<li>公平读写</li>
</ul>
</b>
<h4 id="读者优先"><a class="markdownIt-Anchor" href="#读者优先"></a> 读者优先</h4>
<ul>
<li><strong>一旦有读者正在读数据，则允许随后的读者进入读数据</strong></li>
<li><strong>只有当全部读者退出，才允许写者进入写数据(可能导致写者饥饿)</strong></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> reader_count = <span class="hljs-number">0</span>;     <span class="hljs-comment">// 读者数量，初始为0</span><br>semaphore file = <span class="hljs-number">1</span>;       <span class="hljs-comment">// 文件操作权，初始为1，代表可以操作</span><br>semaphore count_op = <span class="hljs-number">1</span>;   <span class="hljs-comment">// count操作权，初始为1，代表可以操作</span><br><br>reader() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(count_op);                <span class="hljs-comment">// 申请修改count</span><br>    reader_count++;             <span class="hljs-comment">// 读者数量增加</span><br>    <span class="hljs-keyword">if</span>(reader_count == <span class="hljs-number">1</span>) &#123;<br>      P(file);                  <span class="hljs-comment">// 如果现在没有读者正在读文件，第一个读者则要申请使用文件</span><br>    &#125;                           <span class="hljs-comment">// 没有被count_op堵住，说明有读者在读文件，则不用申请使用文件，直接读即可</span><br>    V(count_op);                <span class="hljs-comment">// 必须在申请到资源后才能释放读者数量操作，这样才能把后来的读者堵住，否则后来读者会自行申请资源</span><br>    读文件                       <span class="hljs-comment">// 读文件</span><br>    P(count_op);<br>    reader_count--;<br>    <span class="hljs-keyword">if</span>(reader_count == <span class="hljs-number">0</span>) &#123;<br>      V(file);                  <span class="hljs-comment">// 因为是读者优先，因此不能直接释放文件，要确定没有后来的读者后再释放</span><br>    &#125;<br>    V(count_op);                <span class="hljs-comment">// 释放读者数量操作</span><br>  &#125;<br>&#125;<br><br>writer() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(file);        <span class="hljs-comment">// 申请使用文件</span><br>    写文件          <span class="hljs-comment">// 写文件</span><br>    V(file);        <span class="hljs-comment">// 写完释放文件</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>例题:</p>
<ul>
<li>有一座东西方向的独木桥，同一方向的行人可连续过桥</li>
<li>桥上没有行人过桥时，任何一端的行人均可上桥</li>
<li>独木桥的最大承重为4人</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> E2W_count = <span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> W2E_count = <span class="hljs-number">0</span>;<br>semaphore E2W_count_op = <span class="hljs-number">1</span>;<br>semaphore W2E_count_op = <span class="hljs-number">1</span>;<br>semaphore orientation = <span class="hljs-number">1</span>;<br>semaphore people_count = <span class="hljs-number">4</span>;<br><br>E2W() &#123;<br>  P(E2W_count_op);              <span class="hljs-comment">// 申请操作E2W的人数</span><br>  E2W_count++;                  <span class="hljs-comment">// E2W人数增加</span><br>  <span class="hljs-keyword">if</span>(E2W_count == <span class="hljs-number">1</span>) &#123;          <br>    P(bridge);                  <span class="hljs-comment">// 第一个E2W的人要排队</span><br>  &#125;                             <span class="hljs-comment">// 过了操作E2W说明一定有E2W的人占住了桥</span><br>  V(E2W_count_op);              <span class="hljs-comment">// 释放E2W人数操作</span><br>  P(people_count);              <span class="hljs-comment">// 申请上桥，防止桥超载</span><br>  过桥                          <span class="hljs-comment">// 过桥</span><br>  V(people_count);              <span class="hljs-comment">// 释放桥承载</span><br>  P(E2W_count_op);              <span class="hljs-comment">// 申请操作E2W的人数</span><br>  E2W_count--;                  <span class="hljs-comment">// E2W人数减少</span><br>  <span class="hljs-keyword">if</span>(E2W_count == <span class="hljs-number">0</span>) &#123;<br>    V(bridge);                  <span class="hljs-comment">// 后面没人了则释放桥</span><br>  &#125;<br>  V(E2W_count_op);              <span class="hljs-comment">// 释放E2W人数操作</span><br>&#125;<br><br>W2E() &#123;<br>  P(E2W_count_op);              <span class="hljs-comment">// 申请操作W2E的人数</span><br>  E2W_count++;                  <span class="hljs-comment">// W2E人数增加</span><br>  <span class="hljs-keyword">if</span>(E2W_count == <span class="hljs-number">1</span>) &#123;          <br>    P(bridge);                  <span class="hljs-comment">// 第一个W2E的人要排队</span><br>  &#125;                             <span class="hljs-comment">// 过了操作W2E说明一定有W2E的人占住了桥</span><br>  V(E2W_count_op);              <span class="hljs-comment">// 释放W2E人数操作</span><br>  P(people_count);              <span class="hljs-comment">// 申请上桥，防止桥超载</span><br>  过桥                          <span class="hljs-comment">// 过桥</span><br>  V(people_count);              <span class="hljs-comment">// 释放桥承载</span><br>  P(E2W_count_op);              <span class="hljs-comment">// 申请操作W2E的人数</span><br>  E2W_count--;                  <span class="hljs-comment">// W2E人数减少</span><br>  <span class="hljs-keyword">if</span>(E2W_count == <span class="hljs-number">0</span>) &#123;<br>    V(bridge);                  <span class="hljs-comment">// 后面没人了则释放桥</span><br>  &#125;<br>  V(E2W_count_op);              <span class="hljs-comment">// 释放W2E人数操作</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="公平读写"><a class="markdownIt-Anchor" href="#公平读写"></a> 公平读写</h4>
<p><strong>写过程中，若其它读者、写者到来，则按到达顺序处理</strong><br />
<strong>公平读写可以由读者优先进行简单改进而得到</strong><br />
因为<code>file</code>这个信号量对已经有读者在访问文件时无效，即便前面有写者在排队也会被跳过，因此可以由写者加一个<strong>防插队门锁lock</strong>，即如果读者前面有写者则无法直接插队，而<strong>如果前面的是读者则lock不应该阻止读者一起读</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> reader_count = <span class="hljs-number">0</span>;     <span class="hljs-comment">// 读者数量，初始为0</span><br>semaphore file = <span class="hljs-number">1</span>;       <span class="hljs-comment">// 文件操作权，初始为1，代表可以操作</span><br>semaphore count_op = <span class="hljs-number">1</span>;   <span class="hljs-comment">// count操作权，初始为1，代表可以操作</span><br>semaphore lock = <span class="hljs-number">1</span>;       <span class="hljs-comment">// 防插队锁</span><br><br>reader() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(lock);                    <span class="hljs-comment">// 防插队锁</span><br>    P(count_op);                <span class="hljs-comment">// 申请修改count</span><br>    reader_count++;             <span class="hljs-comment">// 读者数量增加</span><br>    <span class="hljs-keyword">if</span>(reader_count == <span class="hljs-number">1</span>) &#123;<br>      P(file);                  <span class="hljs-comment">// 如果现在没有读者正在读文件，第一个读者则要申请使用文件</span><br>    &#125;                           <span class="hljs-comment">// 没有被count_op堵住，说明有读者在读文件，则不用申请使用文件，直接读即可</span><br>    V(count_op);                <span class="hljs-comment">// 必须在申请到资源后才能释放读者数量操作，这样才能把后来的读者堵住，否则后来读者会自行申请资源</span><br>    V(lock);                    <span class="hljs-comment">// 读者不能阻止后来的读者，因此在一起读前要释放锁</span><br>    读文件                       <span class="hljs-comment">// 读文件</span><br>    P(count_op);<br>    reader_count--;<br>    <span class="hljs-keyword">if</span>(reader_count == <span class="hljs-number">0</span>) &#123;<br>      V(file);                  <span class="hljs-comment">// 因为是读者优先(在其基础上改而成的)，因此不能直接释放文件，要确定没有后来的读者后再释放</span><br>    &#125;<br>    V(count_op);                <span class="hljs-comment">// 释放读者数量操作</span><br>  &#125;<br>&#125;<br><br>writer() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(lock);        <span class="hljs-comment">// 防插队锁</span><br>    P(file);        <span class="hljs-comment">// 申请使用文件</span><br>    写文件          <span class="hljs-comment">// 写文件</span><br>    V(file);        <span class="hljs-comment">// 写完释放文件</span><br>    V(lock);        <span class="hljs-comment">// 释放锁</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="写者优先"><a class="markdownIt-Anchor" href="#写者优先"></a> 写者优先</h4>
<p><strong>当至少有一个写者声明想写数据时，则不再允许新的读者进入读数据</strong><br />
写者优先也是与读者优先类似，<strong>写者可以插队，因此读者必须排队</strong>，而在读写公平加了lock锁后读者就必须排队了，同样写者也要排队，现在写者优先可以通过对写者的防插队锁<code>lock</code>进行<strong>选择性加锁</strong>来实现，同时如果读者在前面有很长的队列，第一个写者需要慢慢排队过去才能让后面的写者插队，因此需要<strong>限制读者队伍长度</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> reader_count = <span class="hljs-number">0</span>;             <span class="hljs-comment">// 读者数量，初始为0</span><br>semaphore file = <span class="hljs-number">1</span>;               <span class="hljs-comment">// 文件操作权，初始为1，代表可以操作</span><br>semaphore reader_count_op = <span class="hljs-number">1</span>;    <span class="hljs-comment">// reader_count操作权，初始为1，代表可以操作</span><br>semaphore lock = <span class="hljs-number">1</span>;               <span class="hljs-comment">// 防插队锁</span><br><span class="hljs-type">int</span> writer_count = <span class="hljs-number">0</span>;             <span class="hljs-comment">// 写者优先也需要计数</span><br>semaphore writer_count_op = <span class="hljs-number">1</span>;    <span class="hljs-comment">// writer_count操作权，初始为1，代表可以操作</span><br>semaphore limit = <span class="hljs-number">1</span>;              <span class="hljs-comment">// 读者队伍长度锁</span><br><br>reader() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(limit);                   <span class="hljs-comment">// 读者队伍长度加锁</span><br>    P(lock);                    <span class="hljs-comment">// 防插队锁</span><br>    P(reader_count_op);         <span class="hljs-comment">// 申请修改count</span><br>    reader_count++;             <span class="hljs-comment">// 读者数量增加</span><br>    <span class="hljs-keyword">if</span>(reader_count == <span class="hljs-number">1</span>) &#123;<br>      P(file);                  <span class="hljs-comment">// 如果现在没有读者正在读文件，第一个读者则要申请使用文件</span><br>    &#125;                           <span class="hljs-comment">// 没有被count_op堵住，说明有读者在读文件，则不用申请使用文件，直接读即可</span><br>    V(reader_count_op);         <span class="hljs-comment">// 必须在申请到资源后才能释放读者数量操作，这样才能把后来的读者堵住，否则后来读者会自行申请资源</span><br>    V(lock);                    <span class="hljs-comment">// 读者不能阻止后来的读者，因此在一起读前要释放锁</span><br>    V(limit);                   <span class="hljs-comment">// 一起读后允许下一个读者进入，这样读者队伍长度就限制在1以内了</span><br>    读文件                       <span class="hljs-comment">// 读文件</span><br>    P(reader_count_op);<br>    reader_count--;<br>    <span class="hljs-keyword">if</span>(reader_count == <span class="hljs-number">0</span>) &#123;<br>      V(file);                  <span class="hljs-comment">// 因为是读者优先(在其基础上改而成的)，因此不能直接释放文件，要确定没有后来的读者后再释放</span><br>    &#125;<br>    V(reader_count_op);         <span class="hljs-comment">// 释放读者数量操作</span><br>  &#125;<br>&#125;<br><br>writer() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(writer_count_op);       <span class="hljs-comment">// 申请写者数操作</span><br>    writer_count++;           <span class="hljs-comment">// 写者数增加</span><br>    <span class="hljs-keyword">if</span>(writer_count == <span class="hljs-number">1</span>) &#123;<br>      P(lock);                <span class="hljs-comment">// 第一个写者排队加锁</span><br>    &#125;                         <span class="hljs-comment">// 后面写者不需要加排队锁，直接插读者队</span><br>    V(writer_count_op);       <span class="hljs-comment">// 释放写者操作</span><br>    P(file);                  <span class="hljs-comment">// 申请使用文件</span><br>    写文件                    <span class="hljs-comment">// 写文件</span><br>    V(file);                  <span class="hljs-comment">// 写完释放文件</span><br>    P(writer_count_op);       <span class="hljs-comment">// 申请写者数操作</span><br>    writer_count--;           <span class="hljs-comment">// 写者数增加</span><br>    <span class="hljs-keyword">if</span>(writer_count == <span class="hljs-number">0</span>) &#123;<br>      V(lock);                <span class="hljs-comment">// 最后一个写者释放让写者插队的锁</span><br>    &#125;<br>    V(writer_count_op);       <span class="hljs-comment">// 释放写者操作</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="理发师问题"><a class="markdownIt-Anchor" href="#理发师问题"></a> 理发师问题</h4>
<p>理发店有1位理发师、1把理发椅和5把供等候理发的顾客坐的椅子。如果没有顾客，则理发师睡觉。当一个顾客到来时，他必须叫醒理发师，如果理发师正在理发时又有顾客到来，则如果有空椅子可坐，他就坐下来等。如果没有空椅子，他就离开</p>
<p><img src="barber.png" srcset="/img/loading.gif" lazyload alt="理发师睡觉问题" /></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> customer_count = <span class="hljs-number">0</span>;      <span class="hljs-comment">// 店里的顾客,含正在理发的人数</span><br>semaphore count_op = <span class="hljs-number">1</span>;      <span class="hljs-comment">// waiting的互斥信号量</span><br>semaphore barber_chair = <span class="hljs-number">1</span>;  <span class="hljs-comment">// 理发椅的个数</span><br>semaphore wating_chair = <span class="hljs-number">5</span>;  <span class="hljs-comment">// 空椅子的个数</span><br>semaphore ready = <span class="hljs-number">0</span>;         <span class="hljs-comment">// 是否有顾客准备好</span><br>semaphore finish = <span class="hljs-number">0</span>;        <span class="hljs-comment">// 理发师是否完成理发</span><br><br>barber() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(ready);                  <span class="hljs-comment">// 顾客准备好</span><br>    理发                       <span class="hljs-comment">// 理发</span><br>    V(finish);                 <span class="hljs-comment">// 完成理发</span><br>  &#125;<br>&#125;<br><br>customer() &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(customer_count_op);         <span class="hljs-comment">// 需要使用顾客数来判断，因此必须保证互斥</span><br>    <span class="hljs-keyword">if</span>(customer_count &lt;= <span class="hljs-number">6</span>) &#123;<br>      customer_count++;           <span class="hljs-comment">// 留下来，顾客数增加</span><br>      V(customer_count_op);       <span class="hljs-comment">// 释放顾客数操作</span><br>      P(wating_chair);            <span class="hljs-comment">// 找空椅子坐下</span><br>      P(barber_chair);            <span class="hljs-comment">// 准备理发</span><br>      V(ready);                   <span class="hljs-comment">// 通知理发师开始</span><br>      P(finish);                  <span class="hljs-comment">// 等待理发师完成</span><br>      V(barber_chair);            <span class="hljs-comment">// 离开</span><br>      P(customer_count_op);       <span class="hljs-comment">// 申请顾客数操作</span><br>      customer_count--;           <span class="hljs-comment">// 顾客数减少</span><br>      V(customer_count_op);       <span class="hljs-comment">// 释放顾客数操作</span><br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>      离开<br>      V(customer_count_op);       <span class="hljs-comment">// 释放顾客数操作</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="哲学家就餐问题"><a class="markdownIt-Anchor" href="#哲学家就餐问题"></a> 哲学家就餐问题</h4>
<p>一张圆桌上坐着5名哲学家，每两个哲学家之间的桌上摆一根筷子，桌子的中间是一碗米饭。哲学家们倾注毕生精力用于思考和进餐，哲学家在思考时，并不影响他人。只有当哲学家饥饿的时候，才试图拿起左、右两根筷子(一根一根地拿起)。如果筷子已在他人手上，则需等待。饥饿的哲学家只有同时拿到了两根筷子才可以开始进餐，当进餐完毕后，放下筷子继续思考。</p>
<p><img src="philosopher.png" srcset="/img/loading.gif" lazyload alt="哲学家就餐问题" /></p>
<p><strong>资源分级一: 为餐叉编号，就餐前，先取用编号较低的餐叉，再取用编号较高的餐叉，就餐毕，先放下编号较高的餐叉，再放下编号较低的餐叉</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c">semaphore chopstick[<span class="hljs-number">5</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>&#125;; <span class="hljs-comment">//初始化信号量</span><br>semaphore mutex = l;                      <span class="hljs-comment">//设置取筷子的信号量</span><br>P(<span class="hljs-type">int</span> i) &#123;                          <span class="hljs-comment">//i号哲学家的进程</span><br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    P(mutex);                  <span class="hljs-comment">//在取筷子前获得互斥量</span><br>    <span class="hljs-keyword">if</span>(i != <span class="hljs-number">4</span>) &#123;<br>      P(chopstick[i]);           <span class="hljs-comment">//取左边筷子(编号低)</span><br>      P(chopstick[(i+<span class="hljs-number">1</span>) % <span class="hljs-number">5</span>]);   <span class="hljs-comment">//取右边筷子(编号高)</span><br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>      P(chopstick[(i+<span class="hljs-number">1</span>) % <span class="hljs-number">5</span>]);   <span class="hljs-comment">//取右边筷子(编号低)</span><br>      P(chopstick[i]);           <span class="hljs-comment">//取左边筷子(编号高)</span><br>    &#125;<br>    V(mutex);                  <span class="hljs-comment">//释放取筷子的信号量</span><br>    就餐                       <span class="hljs-comment">//进餐</span><br>    <span class="hljs-keyword">if</span>(i != <span class="hljs-number">4</span>) &#123;<br>      V(chopstick[(i+l) % <span class="hljs-number">5</span>]);   <span class="hljs-comment">//放回右边筷子(编号高)</span><br>      V(chopstick[i]);           <span class="hljs-comment">//放回左边筷子(编号低)</span><br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>      V(chopstick[i]);          <span class="hljs-comment">//放回左边筷子(编号高)</span><br>      V(chopstick[(i+l) % <span class="hljs-number">5</span>]);  <span class="hljs-comment">//放回右边筷子(编号低)</span><br>    &#125;<br>    思考                      <span class="hljs-comment">// 思考</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>资源分级二: 为哲学家编号，奇数号的哲学家必须首先拿左边的餐叉，偶数号的哲学家必须首先拿右边的餐叉</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c">semaphore chopstick[<span class="hljs-number">5</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>&#125;; <span class="hljs-comment">//初始化信号量</span><br>semaphore mutex = l;                      <span class="hljs-comment">//设置取筷子的信号量</span><br><br>P(<span class="hljs-type">int</span> i) &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    <span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span> != <span class="hljs-number">0</span>) &#123;<br>      wait(fork[i]); <br>      wait(fork[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">5</span>]);      <span class="hljs-comment">// 先左后右</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      wait(fork[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">5</span>]); <br>      wait(fork[i]);            <span class="hljs-comment">// 先右后左</span><br>    &#125;<br>    就餐                        <span class="hljs-comment">//进餐</span><br>    signal(fork[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">5</span>]);      <span class="hljs-comment">//先右后左</span><br>    signal(fork[i]);<br>    思考                        <span class="hljs-comment">// 思考</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>服务生方法: 引入一个餐厅服务生，哲学家必须经过他的允许才能拿起餐叉，并且最多允许4个哲学家同时进食</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c">semaphore chopstick[<span class="hljs-number">5</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>&#125;; <span class="hljs-comment">//初始化信号量</span><br>semaphore mutex = l;                      <span class="hljs-comment">//设置取筷子的信号量</span><br>semaphore room = <span class="hljs-number">4</span>;                       <span class="hljs-comment">// 最多4位哲学家</span><br><br><br>P(<span class="hljs-type">int</span> i) &#123;<br>  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>    wait(room);                             <span class="hljs-comment">//占据就餐位置</span><br>    wait(fork[i]);                          <span class="hljs-comment">//拿起左边的叉子</span><br>    wait(fork[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">5</span>]);                    <span class="hljs-comment">//拿起右边的叉子</span><br>    就餐                                    <span class="hljs-comment">//进餐</span><br>    signal(fork[(i+<span class="hljs-number">1</span>)%<span class="hljs-number">5</span>]);                  <span class="hljs-comment">//放回右边的叉子</span><br>    signal(fork[i]);                        <span class="hljs-comment">//放回左边的叉子</span><br>    signal(room);                           <span class="hljs-comment">//释放就餐位置</span><br>    思考                                    <span class="hljs-comment">// 思考</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="死锁"><a class="markdownIt-Anchor" href="#死锁"></a> 死锁</h2>
<p><strong>定义</strong>: 一组<strong>相互竞争系统资源</strong>或<strong>进行通信</strong>的<strong>进程间</strong>的<strong>永久阻塞</strong></p>
<p><span style="color:#ff562b"><b>当一组进程中的每个进程都在等待某事件，而只有同组进程中阻塞的其他进程能够促发该事件时，死锁发生</b></span></p>
<h3 id="死锁原理"><a class="markdownIt-Anchor" href="#死锁原理"></a> 死锁原理</h3>
<p>资源分为:</p>
<ul>
<li><strong>可重用资源</strong>: 一次仅<strong>供一个进程安全使用且不因使用而耗尽</strong>的资源，如CPU、内存外存、设备等</li>
<li><strong>可消耗资源</strong>: 可消耗资源是指**可被创建(生产)和销毁(消耗)**的资源</li>
</ul>
<p>死锁发生的原因正如定义所言: <strong>竞争系统资源</strong>或<strong>进行通信</strong><br />
<img src="deadlock_example_1.png" srcset="/img/loading.gif" lazyload alt="竞争可重用资源" /><br />
<img src="deadlock_example_2.png" srcset="/img/loading.gif" lazyload alt="竞争可消耗资源(通信)" /></p>
<p><strong>死锁发生的条件</strong>:</p>
<ul>
<li>必要条件
<ul>
<li><strong>互斥</strong>: 一次只有一个进程可以使用一个资源</li>
<li><strong>占有且等待</strong>: 当进程等待其他资源时，继续占有已经分配的资源</li>
<li><strong>不可抢占</strong>: 不能强行抢占进程已经占有的资源</li>
</ul>
</li>
<li>充分条件: <strong>循环等待</strong>: 存在一个闭合的进程链，每个进程至少占有此链中下一个进程所需的一个资源</li>
</ul>
<p><img src="circle_wait.png" srcset="/img/loading.gif" lazyload alt="循环等待" /></p>
<p><img src="deadlock_approach.png" srcset="/img/loading.gif" lazyload alt="死锁解决" /></p>
<h3 id="死锁预防"><a class="markdownIt-Anchor" href="#死锁预防"></a> 死锁预防</h3>
<p>死锁预防的方法就是<strong>防止死锁产生条件的发生</strong>，防止3个必要条件中任意一条发生，也防止循环等待发生</p>
<p><strong>互斥</strong><br />
如果需要对资源互斥访问，那么操作系统必须支持，否则很多OS功能无法实现，因此<strong>无法预防互斥</strong></p>
<p><strong>占有且等待</strong><br />
要求进程<strong>一次性请求所有资源</strong>，并<strong>阻塞这个进程直到所有资源请求能够满足</strong>但进程所需所有资源可能不确定，因此进程可能会阻塞很长时间，并且某些已分配资源可能很久不使用</p>
<p><strong>不可抢占</strong><br />
一个占有某些资源的进程进一步申请资源时若被拒绝，则<strong>释放最初占有的资源</strong>或<strong>操作系统要求另一个进程释放资源</strong></p>
<p><strong>循环等待</strong><br />
定义一个请求资源的顺序，系统把所有资源按类型进行<strong>线性排队</strong>，如<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">R_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">R_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>R</mi><mi>k</mi></msub><mo stretchy="false">(</mo><mi>i</mi><mo>&lt;</mo><mi>j</mi><mo>&lt;</mo><mi>k</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">R_k(i&lt;j&lt;k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">)</span></span></span></span>，所有进程对资源的请求必须严格按资源序号递增的顺序提出</p>
<h3 id="死锁避免"><a class="markdownIt-Anchor" href="#死锁避免"></a> 死锁避免</h3>
<p><strong>死锁避免允许3个必要条件发生</strong>，但在系统运行过程中，检查进程的资源申请，若分配后<strong>系统可能发生死锁则不予分配</strong>，否则予以分配</p>
<p>判断资源分配是否安全的算法称为<strong>银行家算法</strong>:<br />
当用户申请一组资源时，系统必须做出判断: 如果把这些资源分出去，系统是否还处于<strong>安全状态</strong>。若是，就可以分配这些资源，否则，暂时不分配，阻塞进程</p>
<p><strong>注意</strong>: 安全状态是非死锁状态，而<strong>不安全状态并不一定是死锁状态</strong>，即系统处于安全状态一定可以避免死锁，而系统处于不安全状态则仅仅可能进入死锁状态</p>
<p><img src="safe_sequence.png" srcset="/img/loading.gif" lazyload alt="安全状态" /></p>
<p><img src="banker_algorithm.png" srcset="/img/loading.gif" lazyload alt="银行家算法" /></p>
<p>数据结构说明:</p>
<ul>
<li>Available向量: 系统中可利用的资源数目</li>
<li>Max矩阵: 每个进程对每种资源的最大需求</li>
<li>Allocation矩阵: 每个进程已分配的各类资源的数目</li>
<li>Need矩阵: 每个进程还需要的各类资源数</li>
<li><strong>Need[i, j] = Max[i, j] - allocation[i, j]</strong></li>
</ul>
<p>例题:</p>
<div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="banker_algorithm_example_table.png" srcset="/img/loading.gif" lazyload alt="" /></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="banker_algorithm_example_question.png" srcset="/img/loading.gif" lazyload alt="" /></div></div></div>
<p><strong>(1)</strong>: 安全，因为存在安全序列: P2 -&gt; P1 -&gt; P3 -&gt; P4<br />
<strong>(2)</strong>: 分配资源后如图，仍然安全，因为存在安全序列: P2 -&gt; P1 -&gt; P3 -&gt; P4<br />
<img src="banker_algorithm_example_answer_1.png" srcset="/img/loading.gif" lazyload alt="" /><br />
<strong>(3)</strong>: 不能，因为系统剩余资源不足P1要求的资源<br />
<strong>(4)</strong>: 分配资源后如图，不安全，因为剩余资源无法使任何进程结束<br />
<img src="banker_algorithm_example_answer_2.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<p>死锁避免的使用限制</p>
<ul>
<li>必须事先声明每个进程请求的最大资源</li>
<li>进程必须是独立的，它们执行顺序没有同步的要求</li>
<li>分配资源的数量必须是固定的</li>
<li>占有资源时，进程不能退出</li>
</ul>
<h3 id="死锁检测与解除"><a class="markdownIt-Anchor" href="#死锁检测与解除"></a> 死锁检测与解除</h3>
<p>死锁检测与解除允许死锁的发生，只要有可能，就给进程分配其所请求的资源，但会<strong>定时进行死锁检测</strong></p>
<p><strong>死锁检测算法</strong>(<strong>与银行家算法安全性检查中相同</strong>)步骤:</p>
<ol>
<li>标记Allocation矩阵中一行全为零的进程</li>
<li>初始化一个临时向量W，令W等于Available向量</li>
<li>查找下标i，进程i当前未标记且满足Q(<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Q</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Q_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>表示进程i请求j类资源的数量）的第i行小于等于W, 即对所有的k,<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Q</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>≤</mo><msub><mi>W</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">Q_{ik}\leq W_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, 若找不到这样的行，终止算法</li>
<li>若找到这样的行，标记进程i，并把Allcation矩阵中的相应行加到W中，即对所有k, 令<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>W</mi><mi>k</mi></msub><mo>=</mo><msub><mi>W</mi><mi>k</mi></msub><mo>+</mo><msub><mi>A</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">W_k= W_k+A_{ik}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，返回步骤3</li>
</ol>
<p>解除: <strong>检测到死锁后，按照某种可能的策略来解除</strong><br />
策略:</p>
<ul>
<li>撤消进程: 连续撤消死锁进程直到不再存在死锁</li>
<li>回退: 把进程回退到前面定义的某些检查点，并重新启动所有进程</li>
<li>抢占: 连续抢占资源直到不再存在死锁</li>
</ul>
<p>选择原则: 目前为止消耗处理器时间少，或输出少，或分配资源少，或剩余时间长，或优先级最低的进程</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Operating-System/">Operating System</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/02/12/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">内存管理</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/02/09/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%AE%BA/">
                        <span class="hidden-mobile">操作系统概论</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'Thm-lab/blog_commit');
      s.setAttribute('issue-term', 'title');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>





  

  
    <!-- KaTeX -->
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0/dist/katex.min.css" />
  





  <script  src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js" ></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({"theme":"default"});
    }
  </script>







<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
